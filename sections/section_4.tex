\section{Section 4} \label{sec:section_4}

    \todo{Make an intrduction explaining what is the goal of this section, and how we will reach it. Explain what is the purpose of each Claim.}

    \definition[Definition 4.2(a)]\label{def:epsilon_indivisible}
    Let $\epsilon \in (0,1)$.
    We say that $A \subseteq G$ is \emph{$\epsilon$-indivisible} if for every $B \in G$, the truth value $t = t(A,b)$ satisfies
    \[
        |\left\{ a\in A \mid a R b \not\equiv t \right\}| < |A|^{\epsilon}
    \]

    \definition[Definition 4.2(b)]\label{def:f_indivisible}
    Let $f: \mathbb{R} \longrightarrow \mathbb{R}$ be a non-decreasing function.
    We say that $A \subseteq G$ is \emph{$f$-indivisible} if for every $B \in G$, the truth value $t = t(A,b)$ satisfies
    \[
        |\left\{ a\in A \mid a R b \not\equiv t \right\}| < f(|A|)
    \]

%    \remark
%        Notice that the previous two definitions become meaningful only if $|A|^{\epsilon} \leq \frac{\parstraight{A}}{2}$ and
%        $f(|A|) \leq \frac{\parstraight{A}}{2}$ respectively.
%        In this context, the definition of the truth value $t$ is compatible with that of Definition~\ref{def:truth_value}.
%        In particular, Definition~\ref{def:epsilon_indivisible} would require that $\parstraight{A} \geq \parround{2}^{\frac{1}{1-\epsilon}}$.

    \remark
        If $f(n) = \epsilon n$, then $f$-indivisible $\equiv$ $\epsilon$-good.

    \remark
    $\epsilon$-indivisible is a much stronger condition then $\epsilon$-good.

    \todo{From here on, change all $l$'s with $\ell$}
    \todo{Change all sequences of $m$'s as in section 5}

    \lemma[Claim 4.3]\label{existance_of_indivisible_sets}
        Let $G$ be a finite graph with the non-$k_*$-property.
        Let $\left< m\ell \mid \ell \in [0, k_{**}] \right>$ be a sequence of non-zero natural numbers such that
        for all $\ell \in [k_{**}]$, $f(m_{\ell-1}) \geq m_\ell$.
        If $A \subseteq G$, $|A| = m_0$, then for some $\ell < k_{**}$ there is a subset $B \subseteq A$ of size $m_\ell$ which is
        $f$-indivisible.
        \begin{proof}
            Suppose not.
            Then we can construct the sequences $\left< b_\eta \mid \eta \in [2]^{<k} \right>$ and $\left< A_\eta \mid \eta \in [2]^{\leq k} \right>$
            on induction over $k < k_{**}$, where $k = |\eta|$, satisfying:
        \begin{enumerate}
            \item\label{itm:4.3.1} $A_{\eta^\frown \left< i \right>} \subseteq A_{\eta}$, $\forall i \in \left\{0,1\right\}$, $\forall k < k_{**}$
            \item\label{itm:4.3.2} $A_{\eta^\frown \left< 0 \right>} \cap A_{\eta^\frown \left< 1 \right>} = \emptyset$, $\forall k < k_{**}$
            \item\label{itm:4.3.3} $|A_\eta| = m_k$, $\forall k \leq k_{**}$
            \item\label{itm:4.3.4} $b_\eta \in G$ witnessing that $A_\eta$ is not $f$-indivisible, $\forall k < k_{**}$
            \item\label{itm:4.3.5} $A_{\eta^\frown \left< i \right>} \subseteq A_\eta^{(i)} = \left\{ a \in A_\eta \mid a R b_\eta \equiv (i=1) \right\}$,
                $\forall \in \left\{ 0,1 \right\}$, $\forall k < k_{**}$
        \end{enumerate}
        Let's prove the induction:
        \begin{itemize}
            \item \underline{$k=0$}.
                Consider $A_{\left< \cdot \right>} = A$, which satisfies $|A_{\left< \cdot \right>}| = m_0$ and
                $|b_{\left< \cdot \right>}|$ witnessing the non-$f$-indivisibility of $A_{\left< \cdot \right>}$.
            \item \underline{$k \Rightarrow k+1$}.
                We can assume $|A_\eta| = m_k$ and by hypothesis $A_\eta$ is not $f$-indivisible.
                So, there exists $b_\eta$ such that $A_\eta^{(i)} \geq f(m_k) \geq m_{k+1}$ (\ref{itm:4.3.4}), and we can choose
                $A_{\eta^\frown \left< i \right>} \subseteq A_\eta^{(i)}$ (\ref{itm:4.3.5}), such that
                $|A_{\eta^\frown \left< i \right>}| = m_{k+1} \forall i \in \left\{ 0,1 \right\}$ (\ref{itm:4.3.3}).
                (\ref{itm:4.3.1}) and (\ref{itm:4.3.2}) are satisfied by the definition of $A_\eta^{(i)}$.
        \end{itemize}
        Now, for all $\eta$ such that $|\eta| = k_{**}$, consider some element $a_\eta \in A_\eta$.
        Then, we have two sequences $\left< b_\eta \mid \eta \in [2]^{<k_{**}} \right>$ and $\left< A_\eta \mid \eta \in [2]^{k_{**}} \right>$
        with the property:
        \[
            \forall \rho \in [2]^{<k_{**}} \forall \eta \in [2]^{k_{**}} \text{ such that } \rho^\frown \left< i \right> \trianglelefteq
                \eta \text{, } (a_\eta R b_\rho)
        \]
        since $a_\eta \in A_\eta \subseteq A_{\rho ^\frown \left< i \right>}$.
        This contradicts the $k_{**}$ tree bound.
        \end{proof}

    \todo{since we changed $l \in [k_**]$ to $l < k_**$, you should adapt consequently all that follows this point...}
    \lemma[Claim 4.4]\label{existance_of_f_indivisible_partitions}
    Let $G$ be a finite graph with the non-$k_{*}$-order property.
    Assume $m_0 > \dots > m_{k_{**}}$ is a sequence of non-zero natural numbers and for all $l \in [k_{**}]$, $f(m_{l-1}) \geq m_l$.
    If $A \subseteq G$ with $|A| = n$, then we can find a sequence $\overline{A} = \left< A_j \mid j \in [j(*)] \right>$
        and reminder $B = A \setminus \bigcup \overline{A}$ such that:
    \begin{enumerate}
        \item \label{itm:4.4.1} For each $j \in [j(*)]$, $A_j$ is $f$-indivisible
        \item \label{itm:4.4.2} For each $j \in [j(*)]$, $|A_j| \in \left\{ m_0, \dots, m_{k_{**}-1} \right\}$
        \item \label{itm:4.4.3} $A_j \subseteq A \setminus \bigcup\left\{ A_i \mid i < j \right\}$, in particular $A_i \cap A_j = \emptyset$ $\forall i \neq j$
        \item \label{itm:4.4.4} $|B| < m_0$
    \end{enumerate}
        \begin{proof}
        Iteratively, apply Claim ~\ref{existance_of_indivisible_sets} to the remainder $A \setminus \bigcup \left\{ A_i \mid i < j \right\}$
            (\ref{itm:4.4.3}) to get an $f$-indivisible $A_j$ (\ref{itm:4.4.1}) of size $m_l$, $l \in \left\{ 0, \dots, k_{**}-1 \right\}$
            (\ref{itm:4.4.2}) until less then $m_0$ vertices are available (\ref{itm:4.4.4}).
        \end{proof}

    \lemma[Claim 4.5]\label{existance_of_ordered_epsilon_indivisible_partitions}
    Let $G$ be a graph with the non-$k_{*}$-order property.
    Assume $n \geq m_0 > \dots > m_{k_{**}}$ is a sequence of non-zero natural numbers satisfying that for all $l \in [k_{**}]$
        $\lfloor (m_{l-1})^\epsilon \rfloor = m_l$, for $\epsilon \in (0, \frac{1}{2})$.
    If $A \subseteq G$, $|A| = n$, then we can find $\overline{A} = \left< A_i \mid i \in [i(*)] \right>$ with remainder
        $B = A \setminus \bigcup \overline{A}$ such that:
    \begin{enumerate}  % If you do any changes here, update 4.10 too...
        \item \label{itm:4.5.1} For each $j \in [j(*)]$, $A_j$ is $\epsilon$-indivisible
        \item \label{itm:4.5.2} For each $j \in [j(*)]$, $|A_j| \in \left\{ m_0, \dots, m_{k_{**}-1} \right\}$
        \item \label{itm:4.5.3} $A_i \cap A_j = \emptyset$ $\forall i \neq j$
        \item \label{itm:4.5.4} $|B| < m_0$
        \item \label{itm:4.5.5} $\overline{A}$ is $\leq$-increasing
    \end{enumerate}
        \begin{proof}
            The first four clauses are direct consequence of applying Claim~\ref{existance_of_f_indivisible_partitions}
                with $f(n) = n^\epsilon$.
            By renaming the $A_i$'s in ascending-size order, we get (\ref{itm:4.5.5}).
        \end{proof}

    \remark
    In this context, if $m_{k_{**}} > k_{**}$
    \[
        n^{\epsilon^{k_{**}}} \geq m_0^{\epsilon^{k_{**}}} \geq m_1^{\epsilon^{k_{**}-1}} \geq \dots \geq m_{k_{**}} > k_{**}
    \]
    So, $n^{\epsilon^{k_{**}}} > k_{**}$.

    \lemma[Claim 4.6)]\label{average_condition_statement}
    Let $G$ be a finite graph.
    Suppose $A, B \subseteq G$ such that $A$ is $f$-indivisible, $B$ is $g$-indivisible, and $f(|A|) g(|B|) < \frac{1}{2} |B|$.
    Then, for some truth value $t = t(A,B)$ for all but $< f(|A|)$ of the $a \in A$ for all but $< g(|B|)$ of the $b \in B$
        we have that $a R b \equiv t$.
        \begin{proof}
            Since $B$ is $g$-indivisible, for each $a \in A$ there is a truth value $t_a = t(a,B)$ such that
                $\left\{ b \in B \mid a R b \not\equiv t_a \right\} < g(|B|)$.
            Let $U_i = \left\{ a \in A \mid t_a = i \right\}$ for $i \in \left\{ 0,1 \right\}$.
            If either $U_i$ satisfies $|U_i| < f(|A|)$ then the statement is true.
            Suppose not.
            Then, there are $W_i \subseteq U_i$ with $|W_i| = f(|A|)$ for $i \in \left\{ 0,1 \right\}$.
            Now, let $V = \left\{ b \in B \mid (\exists a \in W_0 \mid a R b) \vee (\exists a \in W_1 \mid \lnot a R b) \right\}$,
                i.e. the $b$'s which are an exception for some $a \in W_0 \cup W_1$.
            Then, $|V| < |W_0| g(|B|) + |W_1| g(|B|) = 2 f(|A|) g(|B|) < |B|$, where the first inequality follows the
                $g$-indivisibility of $B$.
            Finally, there is a $b_* \in B \setminus V$ such that $\forall a \in W_0$ $\lnot a R b_*$ and
                $\forall a \in W_1$ $a R b_*$ with $|W_0| = |W_1| = f(|A|)$, which contradicts the $f$-indivisibility of $A$.
        \end{proof}

    \definition
    We say that the pair $(A,B)$ with $A$ $f$-indivisible and $B$ $g$-indivisible satisfies the \emph{average condition} if
        $f(|A|) g(|B|) < \frac{1}{2} |B|$ and thus the statement of Claim~\ref{average_condition_statement} is true for
        the pair $(A,B)$.

    \remark
    The condition $f(|A|) g(|B|) < \frac{1}{2} |B|$ makes ordering of the pair $(A,B)$ matter.
    Thus,
    \[
        (A,B) \text{ has the average condition } \Rightarrow (B,A) \text{ has the average condition }
    \]

    \remark[Remark 4.7]\label{sufficient_requirement_for_average_condition}
        When $f(n) = n^\epsilon$ and $g(n) = n^\zeta$, the average condition is $|A|^\epsilon |V|^\zeta < \frac{1}{2} |B|$.

    \lemma[Claim 4.8]\label{exceptions_bound_of_epsilon_indivisible_sets}
        Let $A$ be $\epsilon$-indivisible, $B$ $\zeta$-indivisible and let the pair $(A,B)$ satisfy the average condition.
        Then, for all $\epsilon_1 \in \left( 0, 1-\epsilon \right)$, $\zeta_1 \in \left( 0, 1-\zeta \right)$, $A' \subseteq A$
            and $B' \subseteq B$ such that $|A'| \geq |A|^{\epsilon + \epsilon_1}$ and $|B'| \geq |B|^{\zeta + \zeta_1}$,
            we have that:
        \[
            \frac{|\left\{ (a,b) \in (A',B') \mid a R b \equiv \neg t(A,B) \right\}|}{|A' \times B'|} \leq
                \frac{1}{|A|}\epsilon_1 + \frac{1}{|B|}\zeta_1
        \]
        \begin{proof}
            Notice:
            \begin{itemize}
                \item There are at most $|A|^\epsilon$ elements of $A$ (hence in $A' \subseteq A$) which are exceptional
                    (in the sense of the average condition).
                \item For each $a \in A$ (hence in $A' \subseteq A$) not exceptional, there are at most $|B|^\zeta$ elements
                    $b \in B$ such that $(a,b)$ does not satisfy the truth value $t(A,B)$, i.e. that are exceptional.
            \end{itemize}
            Putting it all together:
            \[
                \begin{split}
                    \frac{|\left\{ (a,b) \in (A',B') \mid a R b \equiv \neg t(A,B) \right\}|}{|A' \times B'|}
                        &\leq \frac{|A|^\epsilon |B'| + (|A'| - |A|^\epsilon) |B|^\zeta}{|A'| |B'|} \\
                        &= \frac{|A|^\epsilon}{|A'|} + \frac{|A'| - |A|^\epsilon}{|A'|} \frac{|B|^\zeta}{|B'|} \\
                        &\leq \frac{|A|^\epsilon}{|A'|} + \frac{|B|^\zeta}{|B'|} \\
                        &\leq \frac{|A|^\epsilon}{|A|^{\epsilon + \epsilon_1}} + \frac{|B|^\zeta}{|B|^{\zeta + \zeta_1}} \\
                        &= \frac{1}{|A|^\epsilon_1} + \frac{1}{|B|^\zeta_1}
                \end{split}
            \]
        \end{proof}

    \lemma[$f$-indivisible version]\label{exceptions_bound_of_f_indivisible_sets}
        Let $A$ be $f$-indivisible, $B$ $g$-indivisible and let the pair $(A,B)$ satisfy the average condition.
        Then, for all $\epsilon_1 \in \left( 0, 1-\frac{f(|A|)}{|A|} \right)$, $\zeta_1 \in \left( 0, 1-\frac{g(|B|)}{|B|} \right)$, $A' \subseteq A$
            and $B' \subseteq B$ such that $|A'| \geq f(|A|) |A|^{\epsilon_1}$ and $|B'| \geq g(|B|) |B|^{\zeta_1}$,
            we have that:
        \[
            \frac{|\left\{ (a,b) \in (A',B') \mid a R b \equiv \neg t(A,B) \right\}|}{|A' \times B'|} \leq
                \frac{1}{|A|}\epsilon_1 + \frac{1}{|B|}\zeta_1
        \]
        \begin{proof}
            Notice:
            \begin{itemize}
                \item There are at most $f(|A|)$ elements of $A$ (hence in $A' \subseteq A$) which are exceptional
                    (in the sense of the average condition).
                \item For each $a \in A$ (hence in $A' \subseteq A$) not exceptional, there are at most $g(|B|)$ elements
                    $b \in B$ such that $(a,b)$ does not satisfy the truth value $t(A,B)$, i.e. that are exceptional.
            \end{itemize}
            Putting it all together:
            \[
                \begin{split}
                    \frac{|\left\{ (a,b) \in (A',B') \mid a R b \equiv \neg t(A,B) \right\}|}{|A' \times B'|}
                        &\leq \frac{f(|A|) |B'| + (|A'| - f(|A|)) g(|B|)}{|A'| |B'|} \\
                        &= \frac{f(|A|)}{|A'|} + \frac{|A'| - f(|A|)}{|A'|} \frac{g(|B|)}{|B'|} \\
                        &\leq \frac{f(|A|)}{|A'|} + \frac{g(|B|)}{|B'|} \\
                        &\leq \frac{f(|A|)}{f(|A|) |A|^{\epsilon_1}} + \frac{g(|B|)}{g(|B|) |B|^{\zeta_1}} \\
                        &= \frac{1}{|A|^\epsilon_1} + \frac{1}{|B|^\zeta_1}
                \end{split}
            \]
        \end{proof}

    \corollary[Corollary 4.9]
        Let $A$ and $B$ be $f$-indivisible with $f(n) = c$ and $(A,B)$ satisfy the average condition.
        Then, for all $\epsilon_1 \in (0, 1 - \frac{c}{|A|})$, $\zeta_1 \in (0, 1 - \frac{c}{|B|})$, $A' \subseteq A$ and
            $B' \subseteq B$ with $|A'| \geq c |A|^{\epsilon_1}$ and $|B'| \geq c |B|^{\zeta_1}$, we have:
        \[
            \frac{|\left\{ (a,b) \in (A',B') \mid a R b \equiv \neg t(A,B) \right\}|}{|A' \times B'|} \leq
                \frac{1}{|A|}\epsilon_1 + \frac{1}{|B|}\zeta_1
        \]
        \begin{proof}
            Use Claim~\ref{exceptions_bound_of_f_indivisible_sets} with $f(n) = c$.
        \end{proof}

    \lemma[Claim 4.10]
        Let $G$ be a finite graph wit the non-$k_{*}$-order property.
        Assume $n \geq m_0 > \dots > m_{k_{**}}$ is a sequence of non-zero natural numbers and for all $l \in [k_{**}]$,
            $\lfloor (m_{l-1})^\epsilon \rfloor = m_l$, for some $\epsilon \in (0, \frac{1}{2})$ such that $2 < (m_{k_{**}})^{1-2\epsilon}$.
        If $A \subseteq G$ with $|A| = n$, then we can find a sequence $\overline{A} = \left< A_i \mid i \in [i(*)] \right>$
            and reminder $B = A \setminus \bigcup \overline{A}$ satisfying:
        \begin{enumerate}
            \item \label{itm:4.10.1} For each $i \in [i*)]$, $A_i$ is $\epsilon$-indivisible
            \item \label{itm:4.10.2} For each $i \in [i(*)]$, $|A_i| \in \left\{ m_0, \dots, m_{k_{**}-1} \right\}$
            \item \label{itm:4.10.3} $A_i \cap A_j = \emptyset$ $\forall i \neq j$
            \item \label{itm:4.10.4} $|B| < m_0$
            \item \label{itm:4.10.5} $\overline{A}$ is $\leq$-increasing
            \item \label{itm:4.10.6} If $\zeta \in \left(0,\epsilon^{k_{**}}\right)$ then for every $i,j \in [i(*)]$ with $i < j$,
                $A \subseteq A_i$ ad $B \subseteq A_j$ such that $|A| \geq |A_i|^{\epsilon + \zeta}$ and $|B| \geq |A_j|^{\epsilon + \zeta}$
                we have that:
                \[
                    \begin{split}
                        \frac{|\left\{ (a,b) \in (A,B) \mid a R b \equiv \neg t(A_i,A_j) \right\}|}{|A \times B|}
                            &\leq \frac{1}{|A_i|}\zeta + \frac{1}{|A_j|}\zeta \\
                            &\leq \frac{1}{|A|}\zeta + \frac{1}{|B|}\zeta
                    \end{split}
                \]
        \end{enumerate}
        \begin{proof}
            The five points are direct consequence of Claim~\ref{existance_of_ordered_epsilon_indivisible_partitions}.
            Now, for any $A_i, A_j \in \overline{A}$ with $i < j$.
            By (\ref{itm:4.10.2}), there is some $l < k_{**}$ such that $|A_i| \leq |A_j| = m_l$ for some $l < k_{**}$.
            Then, it follows the condition $2 < (m_{k_{**}})^{1-2\epsilon}$ that:
            \[
                \frac{|A|^\epsilon |B|^\epsilon}{|B|}
                    \leq \frac{|B|^{2\epsilon}}{|B|}
                    = \frac{1}{|B|^{1-2\epsilon}}
                    = \frac{1}{m_l^{1-2\epsilon}}
                    \leq \frac{1}{m_{k_{**}}}
                    < \frac{1}{2}
            \]
            i.e. $|A|^\epsilon |B|^\epsilon < \frac{1}{2} |B|$ and by Claim~\ref{sufficient_requirement_for_average_condition}
                the average condition is satisfied.
            Finally, notice that $\epsilon^{k_{**}} < \epsilon < 1 - \epsilon$ since $\epsilon \in (0, \frac{1}{2})$,
                so that $\zeta \in (0, \epsilon ^ {k_{**}}) \subseteq (0, 1 - \epsilon)$ and the condition for
                Claim~\ref{exceptions_bound_of_epsilon_indivisible_sets} is satisfied.
            This gives us (\ref{itm:4.10.6}) and concludes the proof of the statement.
        \end{proof}

    \definition
    Let $A, B$ be $f$-indivisible sets with $f(A) \times f(B) < \frac{1}{2} |B|$.
    Let $\left< A_i \mid i < i_A \right>$ be a partition of $A$ with $|A_i| = m \forall i<i_A$ and
        $\left< B_i \mid i < i_B \right>$ be a partition of $B$ with $|B_i| = m \forall i<i_B$.
    $\varepsilon^+_{A_i,A_j,m}$ is the event:
    \[
        \forall a \in A_i \forall b \in B_i, a R b = t(A,B)
    \]

    \lemma[Claim 4.13]\label{bound_on_the_probability_of_a_subpair_having_no_exceptions}
        Let $G$ be a finite graph wit the non-$k_{*}$-order property.
        Assume $n \geq m_0 > \dots > m_{k_{**}}$ is a sequence of non-zero natural numbers and for all $l \in [k_{**}]$,
            $\lfloor (m_{l-1})^\epsilon \rfloor = m_l$, for some $\epsilon \in (0, \frac{1}{2})$ such that $2 < (m_{k_{**}})^{1-2\epsilon}$.
        Let $A_1, A_2 \subseteq G$ two $\epsilon$-indivisible subsets such that $|A_1| = m_{l_1}$ and $|A_2| = m_{l_2}$
            for some $l_1, l_2 < k_{**}$ and $|A_1| \leq |A_2|$.
        We will assume some approximation error by supposing $m_l = (m_{l-1})^\epsilon$.
        Suppose that, for some $c \in (0, 1-\epsilon)$ and $\zeta \leq \frac{1 - \epsilon - c}{3}\epsilon^{k_{**}}$,
            $m = n^\zeta$ divides $|A_1|$ and $|A_2|$.
        Then, let $\left< A_{1,s} \mid s \in \left[ \frac{|A_1|}{m} \right] \right>$ and
            $\left< A_{2,t} \mid t \in \left[ \frac{|A_2|}{m} \right] \right>$ be random partitions of $A_1$ and $A_2$
            respectively, with pieces of size $m$.
        We have that
        \[
            P(\varepsilon^+_{A_{1,s},A_{2,t},m}) \geq 1 - \frac{2}{n^{c\epsilon^{k_{**}}}}
        \]
        \begin{proof}
            Fix $s \in \frac{|A_1|}{m}$, $t \in \frac{|A_2|}{m}$.
            % TODO: copy the necessary section in Claim 4.10 or make it a separate claim/remark and reference it here.
            % (to prove average condition is satisfied)
            \[
                \text{UPS, something is missing here}
            \]
            \dots and thus the average condition is satisfied.
            Let $U_1 = \left\{ a \in A_1 \mid |\left\{ b \in A_2 \mid a R b \equiv \neg t(A_1, A_2) \right\}| \geq |A_2|^\epsilon \right\}$
                and for each $a \in A_1 \setminus U_1$ let $U_{2,a} = \left\{ b \in A_j \mid a R b \equiv \neg t(A_1, A_2) \right\}$
            By Claim~\ref{average_condition_statement}, $|U_1| \leq |A_1|^\epsilon$ and $\forall a \in A_1 \setminus U_1$,
                $|U_2| \leq |A_2|^\epsilon$.
            Now, we can bound the probability $P_1$ that $A_{1,s} \cap U_1 \neq \emptyset$ as follows:
            \[
                \begin{split}
                    P_1
                        & \leq \frac{|U_1|}{|A_1|} + \dots + \frac{|U_1|}{|A_1|-m+1}
                            < \frac{m |U_1|}{|A_1| - m}
                            \leq \frac{m |A_1|^\epsilon}{|A_1| - m} \\
                        & \leq \frac{m^2 |A_1|^\epsilon}{|A_1|}
                            = \frac{m^2}{|A_1|^{1-\epsilon}}
                            = \frac{n^{2 \zeta}}{n^{(1-\epsilon)\epsilon^{l_1}}} \\ % the approximation error is here
                        & \leq \frac{n^{2\frac{1-\epsilon-c}{3} \epsilon^{k_{**}}}}{n^{(1-\epsilon)\epsilon^{k_{**}}}}
                            \leq \frac{n^{(1-\epsilon-c) \epsilon^{k_{**}}}}{n^{(1-\epsilon)\epsilon^{k_{**}}}}
                            = \frac{1}{n^{c \epsilon^{k_{**}}}}
                \end{split}
            \]
            The forth inequality comes from the fact that $\frac{(|A_i| - m) m}{|A_i|} \geq 1$.
            Then, if $A_{1,s} \cap U_1= \emptyset$, we have that $|\bigcup_{a \in A_{1,s}} U_{2,a}| \leq |A_{1,s}| |A_2|^\epsilon$.
            So we can bound $P_2$, the probability that $A_{2,t} \cap \bigcup_{a \in A_{1,s}} U_{2,a} = \emptyset$, by:
            \[
                \begin{split}
                    P_2
                        & \leq \frac{|\bigcup_{a \in A_{1,s}} U_{2,a}|}{|A_2|} + \dots + \frac{|\bigcup_{a \in A_{1,s}} U_{2,a}|}{|A_2|-m+1}
                            < \frac{m |\bigcup_{a \in A_{1,s}} U_{2,a}|}{|A_2| - m}
                            \leq \frac{m m |A_2|^\epsilon}{|A_2| - m} \\
                        & \leq \frac{m^3 |A_2|^\epsilon}{|A_2|}
                            = \frac{m^3}{|A_2|^{1-\epsilon}}
                            = \frac{n^{3 \zeta}}{n^{(1-\epsilon)\epsilon^{l_2}}} \\ % the approximation error is here
                        & \leq \frac{n^{3\frac{1-\epsilon-c}{3} \epsilon^{k_{**}}}}{n^{(1-\epsilon)\epsilon^{k_{**}}}}
                            \leq \frac{n^{(1-\epsilon-c) \epsilon^{k_{**}}}}{n^{(1-\epsilon)\epsilon^{k_{**}}}}
                            = \frac{1}{n^{c \epsilon^{k_{**}}}}
                \end{split}
            \]
            Putting it all together:
            \[
                P(\varepsilon^+_{A_{1,s},A_{2,t},m})
                    \geq (1 - P_1) (1 - P_2)
                    \geq \left(1 - \frac{1}{n^{c \epsilon^{k_{**}}}}\right)^2
                    \geq 1 - \frac{2}{n^{c\epsilon^{k_{**}}}}
            \]
        \end{proof}

    \remark\label{subpair_bound_specification}
    Since $\epsilon < \frac{1}{2}$, we can take $c = 1 - 2\epsilon$.
    In this context, $\zeta \leq \frac{\epsilon^{k_{**}+1}}{3}$.

    \lemma[Claim 4.14]\label{existance_of_equitative_partition_with_bound_exceptional_pairs}
        Let $G$ be a finite graph wit the non-$k_{*}$-order property.
        Assume $n \geq m_0 > \dots > m_{k_{**}}$ is a sequence of non-zero natural numbers and for all $l \in [k_{**}]$,
            $\lfloor (m_{l-1})^\epsilon \rfloor = m_l$, for some $\epsilon \in (0, \frac{1}{2})$ such that $2 < (m_{k_{**}})^{1-2\epsilon}$.
        Also, let $m_0$ be small enough to satisfy $m_0 < \frac{n}{n^{(1 - 2\epsilon)\epsilon^{k_{**}}}}$ and
            $m_0 \leq \frac{\sqrt{2}-1}{\sqrt{2}} n$.
        Finally, let $m_{**}$ be a divisor of $m_l$ for all $l < k_{**}$ and $m_{**} \leq n^{\frac{\epsilon^{k_{**}+1}}{3}}$.
        % TODO: probably, this last condition can be removed.
        If $A \subseteq G$ with $|A| = n$, then we can find a partition $\overline{A} = \left< A_i \mid i \in [r] \right>$
            with reminder $B = A \setminus \bigcup \overline{A}$ such that:
        \begin{enumerate}
            \item\label{itm:4.14.1} $|A_i| = m_{**} \forall i \in [r]$
            \item\label{itm:4.14.2} For all but $\frac{2r^2}{n^{(1-2\epsilon)\epsilon^{k_{**}}}}$ of the pairs
                $(A_i, A_j)$ with $i<j$ there are no exceptional edges, i.e.
                \[
                    \left\{ (a,b) \in A_i \times A_j \mid a R b \not\equiv t(A_i, A_j) \right\} = \emptyset
                \]
            \item\label{itm:4.14.3} $|B| < m_0$
        \end{enumerate}
        \begin{proof}
            We can use Claim~\ref{existance_of_ordered_epsilon_indivisible_partitions} to get a partition
                $\overline{A'} = \left< A'_i \mid i \in [i(*)] \right>$ and remainder $B' = A \setminus \bigcup A'$.
            We can refine the partition by randomly splitting each $A'_i$ into pieces of size $m_{**}$ (\ref{itm:4.14.1}).
            Consider the resulting partition $\overline{A} = \left< A_i \mid i \in [r] \right>$ with remainder $B = B'$
                (\ref{itm:4.14.3}).
            First of all, notice that for each pair $(A_i, A_j)$ such that $A_i \subseteq A'_{i_1}$ and
                $A_j \subseteq A'_{j_1}$ with $i_1 \neq j_1$, the probability of the pair having exceptional edges is
                upper bounded by $\frac{2}{n^{(1-2\epsilon)\epsilon^{k_{**}}}}$.
            This follows Claim~\ref{bound_on_the_probability_of_a_subpair_having_no_exceptions} in the context of
                Remark~\ref{subpair_bound_specification}.
            Thus, given $X$ the random variable counting the number of exceptional pairs of this kind, we have
            \[
                E(X) = \sum_{\substack{A_i,A_j \text{ s.t.}\\A_i\subseteq A'_{i_1},A_j\subseteq A'_{j_1}\\i_1\neq j_1}} E(X_{A_i, A_j})
                    = \sum_{\substack{A_i,A_j \text{ s.t.}\\A_i\subseteq A'_{i_1},A_j\subseteq A'_{j_1}\\i_1\neq j_1}} P(\varepsilon_{A_i, A_j,m_{**}})
                    \leq \frac{r^2}{2} \frac{2}{n^{(1-2\epsilon)\epsilon^{k_{**}}}}
            \]
                where $X_{A_i,A_j}$ is the random variable giving $1$ if $(A_i, A_j)$ is exceptional, and $0$ otherwise.
            Now, we have no control if $i_1 = j_1$, so let's bound how many of these we have:
            \[
                \begin{split}
                    |\left\{ \text{Esceptional } (A_i, A_j) \mid A_i, A_j \subseteq A'_{i_1}, i_1 \in [i(*)] \right\}|
                        & \leq {\frac{m_0}{m_{**}} \choose 2} \frac{n}{m_0} \\
                        & \leq \frac{{\frac{m_0}{m_{**}} \choose 2}^2}{2} \frac{n}{m_0}
                            = \frac{m_0 n}{2 m_{**}^2}
                            = \frac{m_0}{n} \left( \frac{n}{\sqrt{2}m_{**}} \right)^2 \\
                        & \leq \frac{m_0}{n} \left( \frac{n - m_0}{m_{**}} \right)^2
                            \leq \frac{m_0}{n} r^2
                            < \frac{r^2}{n^{(1-2\epsilon) \epsilon^{k_{**}}}}
                \end{split}
            \]
            Putting it all together, we see that the number of exceptional pairs is upper bounded by
                $\frac{2r^2}{n^{(1-2\epsilon)\epsilon^{k_{**}}}}$ satisfying (\ref{itm:4.14.2}).
        \end{proof}

    \remark[Remark 4.15]
        Notice that, in the previous proof, the condition $m_0 < \frac{n}{n^{(1-2\epsilon)\epsilon^{k_{**}}}}$ can be
            weakened at the cost of increasing the number of exceptional pairs.
        More specifically, since this condition is only used to bound the exceptional sub-pairs in the same pair
            (the second part of the proof), the number of exceptional pairs can be generally bounded by
            \[
                |\left\{ \text{Exceptional pairs} \right\}|
                    \leq \left( \frac{m_0}{n} + \frac{2}{n^{(1-2\epsilon)\epsilon^{k_{**}}}} \right) r^2
            \]

    \theorem[Theorem 4.16]
        Let $\epsilon = \frac{1}{r} \in \left( 0, \frac{1}{2} \right)$ with $r \in \mathbb{N}$ (this avoids rounding error)
            and $k_*$ be given.
        Let $G$ be a finite graph with the non-$k_*$-order property.
        Let $A \subseteq G$ with $|A| = n$.
        Then, for any $m_{**} \leq n^{\frac{\epsilon^{k_{**}+1}}{3}}$, there is a partition
            $\overline{A} = \left< A_i \mid i \in [m] \right>$ of $A$ with remainder $B = A \setminus \bigcup \overline{A}$
            such that:
        \begin{enumerate}
            \item\label{itm:4.16.1} $|A_i| = m_{**} \forall i \in [m]$
            \item\label{itm:4.16.2} $|B| < n^{\frac{\epsilon}{3}}$
            \item\label{itm:4.16.3} $|\left\{ (i,j) \mid i,j \in [m], i < j \text{ and }
                \left\{ (a,b) \in A_i \times A_j \mid a R b \right\} \notin
                \left\{ A_i \times A_j, \emptyset \right\} \right\}|
                \leq \frac{2}{n^{(1-2\epsilon)\epsilon^{k_{**}}}} m^2$
        \end{enumerate}
        \begin{proof}
            Let $m_{k_{**}}$ be the smaller multiple of $m_{**}$ such that $2 < (m_{k_{**}})^{1-2\epsilon}$.
            Then, consider the sequence
                \[
                    m_{**} \leq m_{k_{**}} < \dots < m_0
                \]
                such that for all $l \in [k_{**}]$ we have that $m_{l-1} = m_l^r$.
            Notice that:
            \begin{enumerate}
                \item $m_{**}$ divides $m_l$ for all $l \in [0, k_{**}]$ since the $m_l$'s are powers of $m_{k_{**}}$
                    and $m_{**}$ divides $m_{k_{**}}$ by construction.
                \item $(m_{l-1})^\epsilon = m_l \forall l \in [k_{**}]$
                \item \[
                    \begin{split}
                        \underline{m_0}
                            & = m_{k_{**}}^{r^{k_{**}}}
                                \leq m_{**}^{r^{k_{**}}}
                                \leq n^{\frac{\epsilon}{3}\epsilon^{k_{**}}r^{k_{**}}}
                                = \underline{n^{\frac{\epsilon}{3}}} \\
                            & < n^{\frac{1}{6}}
                                < n^{1-\frac{1}{2}\epsilon^{k_{**}}}
                                = \underline{\frac{n}{n^{\frac{1}{2}\epsilon^{k_{**}}}}}
                                < \underline{n}
                    \end{split}
                \]
            \end{enumerate}
            So, all the conditions are satisfied to apply Claim~\ref{existance_of_equitative_partition_with_bound_exceptional_pairs},
                which gives us the partition $\overline{A}$ with remainder $B$ satisfying the statement.
            Notice that (\ref{itm:4.16.2}) is satisfied by the fact that $|B| < m_0 \leq n^{\left(\frac{1}{6} - \frac{\epsilon}{3}\right)}$.
        \end{proof}
    % TODO: make a complementary of this theorem with another value of c, which removes the need of (1-2\epsilon) in (3).

    \remark
    Let $n^{\frac{\epsilon^{k_{**}+1}}{3}}$ be an integer and let $m_{**}$ take this value.
    Then, the number of pieces of the partition is at most $n^c$ with $c = 1 - \frac{\epsilon^{k_{**}+1}}{3}$.

    \definition[Definition 4.18]\label{n_large_enough_property}
    For $n, c \in \mathbb{N}$ and $\epsilon, \zeta, \xi \in \mathbb{R}$, let $\oplus[n, \epsilon, \zeta, \xi, c]$ be
        the statement:
    For any set $A$ and $P \subseteq \mathcal{P}(A)$ such that $|A| = n$, $|P| \leq n^{\frac{1}{\zeta}}$ and for all
        $B \in P$ $|B| \leq n^\epsilon$, there exists $U \subseteq A$ with $|U| = \lfloor n^\xi \rfloor$ such that
        for all $B \in P$ $|U \cap B| \leq c$.

    \lemma[Lemma 4.19]\label{n_large_enough_valid_values}
        If the reals $\epsilon, \zeta, \xi$ and the natural numbers $n, c$ satisfy:
        \begin{itemize}
            \item $\epsilon \in (0,1)$
            \item $\zeta > 0$
            \item $0 < \xi < \min(1-\epsilon, \frac{1}{2})$
            \item $n$ sufficiently large ($n > n(\epsilon, \zeta, \xi, c)$) to satisfy the equation:\[
                \frac{1}{2n^{1-2\xi}} + \frac{1}{n^{(1 - \xi - \epsilon)c - \frac{1}{\zeta}}} < 1
            \]
            \item $c > \frac{1}{\zeta (1 - \xi - \epsilon)}$
        \end{itemize}
            then $\oplus[n, \epsilon, \zeta, \xi, c]$ holds.
        \begin{proof}
            Let $m = \lfloor n^\xi \rfloor$ the size of the set $U$ we want to build, and let $\mathcal{F}_* = [A]^m$
                the set of sequences of elements of $A$ with length $m$.
            Let $\mu$ be a probability distribution on $\mathcal{F}_*$ such that for all $F \in \mathcal{F}_*$
                $\mu(F) = \frac{|F|}{|\mathcal{F}_*|}$.
            We want to prove that the probability that a random $U$ satisfies:
            \begin{enumerate}
                \item\label{itm:4.19.1} All elements of $U$ are distinct
                \item\label{itm:4.19.2} For all $B \in P$ $|U \cap B| < K$
            \end{enumerate}
                is not trivial.
            First of all let's bound the converse (\ref{itm:4.19.1}) i.e. the probability that there are two equal elements
                in $U$:
            \[
                P_1 = P(\exists s < t \in [m] \mid U_s = U_t)
                    \leq {m \choose 2} \frac{n}{n^2}
                    \leq \frac{m^2}{2n}
                    \leq \frac{n^{2\xi}}{2n}
                    < \frac{1}{2n^{1-2\xi}}
            \]
            Now, in order to bound (\ref{itm:4.19.2}), let's first bound the probability that at least $c$ elements of
                $U$ are in a given $B \in P$:
            \[
                P_B = P(\exists^{\geq c} t\in [m] \mid U_t \in B)
                    \leq {m \choose c} \left( \frac{|B|}{n} \right)^c
                    \leq \frac{m^c |B|^c}{n^c}
                    \leq \frac{n^{\xi c} n^{\epsilon c}}{n^c}
                    = \frac{1}{n^{c (1 - \xi - \epsilon)}}
            \]
            Then, we can bound the converse of (\ref{itm:4.19.2}), i.e. the probability that this happens for some $B \in P$,
                by:
            \[
                P_2 = P(\exists B \in P \mid \exists^{\geq c} t\in [m], U_t \in B)
                    \leq \sum_{B \in P} P_B
                    = \frac{|P|}{n^{c (1 - \xi - \epsilon)}}
                    \leq \frac{1}{n^{c (1 - \xi - \epsilon) - \frac{1}{\xi}}}
            \]
            Putting it all together, we have that
            \[
                P((\ref{itm:4.19.1}) \cup (\ref{itm:4.19.2}))
                    \leq P_1 + P_2
                    < \frac{1}{2n^{1-2\xi}} + \frac{1}{n^{c (1 - \xi - \epsilon) - \frac{1}{\xi}}}
            \]
            Notice that
            \begin{itemize}
                \item Since $\xi < \frac{1}{2}$ we have that $1 - 2\xi > 0$
                \item Since $\xi < 1 - \epsilon$, we have that $1 - \epsilon - \xi > 0$ and given that $c$ is natural
                    $c (1 - \xi - \epsilon) > 0$
            \end{itemize}
                so, the $n$-large enough condition of the forth point of the statement is well defined and
            \[
                P((\ref{itm:4.19.1}) \cup (\ref{itm:4.19.2}))
                    < \frac{1}{2n^{1-2\xi}} + \frac{1}{n^{c (1 - \xi - \epsilon) - \frac{1}{\xi}}}
                    < 1
            \]
            Thus, the probability that there exists a $U \subseteq A$ satisfying the condition is non-trivial,
                and $\oplus[n, \epsilon, \zeta, \xi, c]$ holds.
        \end{proof}

    \lemma[Claim 4.21]\label{many_values_to_equitative_partition_with_bound_exceptional_pairs}
        Let $k_*, k, c \in \mathbb{N}$ and $\epsilon, \xi \in \mathbb{R}$ such that:
        \begin{enumerate}
            \item\label{itm:4.21.1} $G$ is a graph with the non-$k_*$-order property
            \item\label{itm:4.21.2} $A \subseteq G$ implies $|\left\{ \left\{ a \in A \mid a R b \equiv t(a,b) \right\} \mid b \in G \right\}|
                \leq |A|^k$
            \item\label{itm:4.21.3} $\epsilon \in \left(0, \frac{1}{2}\right)$
            \item\label{itm:4.21.4} $\xi \in \left(0, \frac{\epsilon^{k_{**}}}{2} \right)$
            \item\label{itm:4.21.5} $c$ satisfies \[
                c > \frac{1}{\frac{1}{k} (1 - \frac{\xi}{\epsilon^{k_{**}}} - \epsilon)}
            \]
        \end{enumerate}
        Then, for every sufficiently large $n \in \mathbb{N}$ ($n^{\epsilon^{k_{**}}} > n\left( \epsilon, \frac{1}{k},
            \frac{\xi}{\epsilon^{k_{**}}}, c \right)$ in the sense of Lemma~\ref{n_large_enough_valid_values} (d)), if
            $A \subseteq G$ with $|A| = n$, then there is $Z \subseteq A$ such that
        \begin{enumerate}[label=(\alph*), ref=\alph*]
            \item\label{itm:4.21.a} $|Z| = \lfloor n^\xi \rfloor$
            \item\label{itm:4.21.b} $Z$ is $\epsilon$-indivisible in $G$
        \end{enumerate}
        \begin{proof}
            In order to simplify the calculation, we will assume that $n^{\epsilon^l} \in \mathbb{N} \forall l \leq k_{**}$.
            Notice that can be easily achieved by setting $\epsilon$ as $\epsilon = \frac{1}{r}$ with $r \in \mathbb{N}$.
            Let $n = m_0 > m_1 > \dots > m_{k_{**}}$ with $m_l = n^{\epsilon^{l}}$.
            So $m_{l+1} = m_l^\epsilon = \lfloor (m_l)^\epsilon \rfloor$ and we can use Claim~\ref{existance_of_indivisible_sets}
                to get $A_1 \subseteq A$ with $|A_1| = m_l$ for some $l \leq k_{**}$ and $A_1$ $\epsilon$-indivisible.
            By (\ref{itm:4.21.2}) we have that $|P_1| \leq |A_1|^k = m_l^k$.
            Notice that:
            \begin{itemize}
                \item $\epsilon \in (0,1)$ by (\ref{itm:4.21.3})
                \item $\zeta \coloneqq \frac{1}{k} > 0$
                \item since $\epsilon \in \left( 0, \frac{1}{2} \right)$ by (\ref{itm:4.21.3}), then by (\ref{itm:4.21.4})
                    $\frac{\xi}{\epsilon^l} \leq \frac{\xi}{\epsilon^{k_{**}}} < \frac{1}{2} < 1 - \epsilon$ and
                    thus $0 < \xi < \min(1-\epsilon, \frac{1}{2})$
                \item $m_l$ sufficiently large: $m_l = n^{\epsilon^l} \geq n^{\epsilon^{k_**}} > n\left( \epsilon, \frac{1}{k},
                    \frac{\xi}{\epsilon^{k_{**}}}, c \right) > n\left( \epsilon, \zeta, \frac{\xi}{\epsilon^{l}}, c \right)$
                \item $c > \frac{1}{\frac{1}{k} (1 - \frac{\xi}{\epsilon^{k_{**}}} - \epsilon)}
                    \geq \frac{1}{\zeta (1 - \frac{\xi}{\epsilon^{k_{**}}} - \epsilon)}$
            \end{itemize}
            By Lemma~\ref{n_large_enough_valid_values} then, $\oplus\left[ m_l, \epsilon, \zeta, \frac{\xi}{\epsilon^l} \right]$
                holds, and by taking $A_{(\ref{n_large_enough_property})} \coloneqq A_1$ and
                $P_{(\ref{n_large_enough_property})} \coloneqq P_1$ we have that:
            \begin{itemize}
                \item $|A_1| = m_l$
                \item $|P_1| \leq m_l^k = m_l^{\frac{1}{\zeta}}$
                \item $\forall B \in P_1$, $|B| \leq |A_1|^\epsilon$ by $\epsilon$-indivisibility of $A_1$
            \end{itemize}
            Thus, by Definition~\ref{n_large_enough_property} we have that there exists $Z \subseteq A_1$ such that:
            \begin{itemize}
                \item $|U| = \lfloor m_l^{\frac{\xi}{\epsilon^l}} \rfloor = \lfloor n^{\epsilon^l \frac{\xi}{\epsilon^l}} \rfloor
                    \lfloor n^\xi \rfloor$ satisfying (\ref{itm:4.21.a})
                \item $Z$ is $c$-indivisible since $|B \cap Z| \leq c \forall B \in P_1$, satisfying (\ref{itm:4.21.b})
            \end{itemize}
            This proves the statement.
        \end{proof}

    \lemma[Remark 4.22]\label{k_asterisk_enough_for_k}
    Notice that if $k = k_*$, the condition (\ref{itm:4.21.2}) will be satisfied by Claim ??? % TODO: add the claim
        and the non-$k_*$-order of $G$.

    \theorem[Theorem 4.23]
        Let $G$ be a graph with the non-$k_*$-property.
        For any $c \in \mathbb{N}$, $\epsilon, \xi \in \mathbb{R}$ satisfying the hypothesis of Claim~\ref{many_values_to_equitative_partition_with_bound_exceptional_pairs}
            (with $k = k_*$ and $\zeta = \frac{1}{k_*}$), any $\theta \in (0,1)$ and $A \subseteq G$ with
            $A = n > n\left( c, \epsilon, \zeta, \xi, \theta \right)$ (i.e. $n$ large enough in the sense of Claim~\ref{n_large_enough_valid_values}),
            there is a partition $\overline{A} = \left< A_i \mid i \in [i(*)] \right>$ of $A$ with remainder $B = A \setminus \bigcup \overline{A}$
            satisfying:
        \begin{itemize}
            \item $|A_i| = \lfloor \lfloor n^\theta \rfloor ^\zeta \rfloor \forall i \in [i(*)]$
            \item $A_i$ is $c$-indivisible $\forall i \in [i(*)]$ where $c$ is the constant function $f(x) = c$
            \item $|B| < \lfloor n^{\frac{\theta}{\epsilon^{k_{**}}}} \rfloor$
        \end{itemize}
        \begin{proof}
            Let $n > \left( n\left( \epsilon, \frac{1}{k_*}, \frac{\xi}{\epsilon^{k_{**}}}, c \right)^{\frac{1}{\epsilon^{k_{**}}} + 1} \right)^{\frac{1}{\theta}}$
                in the sense of Lemma~\ref{n_large_enough_valid_values}, so that $\lfloor n^\theta \rfloor$ satisfies the
                large enough condition of Claim~\ref{many_values_to_equitative_partition_with_bound_exceptional_pairs}:
                \[
                    \left( \lfloor n^\theta \rfloor \right)^{\epsilon^{k_{**}}}
                        > n\left( \epsilon, \frac{1}{k_*}, \frac{\xi}{\epsilon^{k_{**}}}, c \right)
                \]
            Notice that condition (\ref{itm:4.21.2}) in Claim~\ref{many_values_to_equitative_partition_with_bound_exceptional_pairs}
                is satisfied by Remark~\ref{k_asterisk_enough_for_k}.
            Now, we define a decreasing sequence $m_0 > m_1 > \dots > m_{k_{**}}$ with $m_{k_{**}} = \lfloor n^\theta \rfloor$
                and $m_{k_{**}-j} = \lceil \left( m_{k_{**}-j+1} \right)^{\frac{1}{\epsilon}} \rceil \forall j \in [1, k_{**}]$.
            This sequence satisfies the condition of Claim~\ref{existance_of_indivisible_sets} for $f(n) = n^\epsilon$.
            We will build a sequence of disjoint $c$-indivisible subsets $A_i$ by induction on $i$ as follows.
            Let $R_i = A \setminus \bigcup_{j<i} A_j$ (so $R_1 = A$).
            If $R_i < \lfloor n^{\frac{\theta}{\epsilon^{k_{**}}}} \rfloor$, then
                $\overline{A} = \left< A_j \mid j < i = i(*) \right>$ and $B = R_i$, and we are done.
            Otherwise, we can apply Claim~\ref{existance_of_indivisible_sets} to $R_i$ with the sequence
                $\left< m_l \right>_{l \leq k_{**}}$, to obtain an $\epsilon$-indivisible subset $B_i \subseteq R_i$ of
                size $m_{k_{**}-l}$.
            Then, since $|B_i| = m_{k_{**}-l} \geq m_{k_{**}} = \lfloor n^\theta \rfloor$ by the $n$-large-enough assumption,
                we can apply Claim~\ref{many_values_to_equitative_partition_with_bound_exceptional_pairs} and get a
                $c$-indivisible subset $Z_i$ of size $|Z_i| = \lfloor m_{k_{**}-l}^\zeta \rfloor
                \geq \lfloor \lfloor n^{\frac{\theta}{\epsilon^l}} \rfloor ^\zeta \rfloor
                \geq \lfloor \lfloor n^{\theta} \rfloor ^\zeta \rfloor$.
            Since $c$-indivisible is preserved when taking subsets, % TODO: make it a remark
                we can choose $A_i \subseteq Z_i$ $c$-indivisible of size $\lfloor \lfloor n^{\theta} \rfloor ^\zeta \rfloor$.
        \end{proof}

    % up to here it was compiling with no problem.

\section{Section 6} \label{sec:section_6}

    % \Cref{thm:existance_of_regular_partitions}

    Property testing is a field of theoretical computer science, concerned about finding low-complexity algorithms
    for testing approximate properties in large objects, such as graphs.
    These algorithm need to be successful with high probability, and are only required to distinguish between objects
    that do not satisfy the property, and those which are \say{far} from satisfying it.
    For the purposes of this thesis, it is useful to formalize these concepts in the context of graphs.

    \begin{definition}
        We say that a graph $G$ is \emph{$\epsilon$-far} from satisfying a graph property $\mathcal{P}$ if no adding or
        removing of up to $\epsilon {|G| \choose 2}$ edges in $G$ results in the graph satisfying the property.
    \end{definition}

    \begin{definition}
        An \emph{$\epsilon$-test} $\mathcal{A}$ deciding a graphs property $\mathcal{P}$ with query complexity
        $q(n)$ is a randomized algorithm that, on input graph $G$,
        satisfies:
        \begin{enumerate}
            \item If $G \in \mathcal{P}$, then $P\parround{\mathcal{A} \text{ accepts } G} \geq \frac{2}{3}$.
            \item If $G$ is $\epsilon$-far from satisfying $\mathcal{P}$,
                then $P\parround{\mathcal{A} \text{ rejects } G} \geq \frac{2}{3}$.
        \end{enumerate}

        The query complexity $q(n)$ is the maximum number of queries the algorithm makes to discern whether a desired
        pair of vertices in the input graph $G$ of size $n$ is adjacent or not.
    \end{definition}

    Of course, the most desirable testers are those with lower query complexity.
    A class of particular interest is that of testers which complexity does not grow with the size of the
    graph.
    \emph{Testable} properties are those for which such testers exist.

    \begin{definition}
        We say that a property $\mathcal{P}$ is \emph{testable} if there exists an $\epsilon$-test deciding $\mathcal{P}$
        with a constant query-complexity with respect to the size of the input graph, that is, it only depends on the
        parameter $\epsilon$.
    \end{definition}

    A case of particular interest is that of \emph{hereditary} properties, i.e. these properties that are preserved under
    taking induced subgraphs.
    In this context, Szemer\'edi's Regularity Lemma found an application in proving the following result:

    \begin{theorem}[Alon \& Shapira Theorem,~\cite{a_characterization_of_the_natural_graph_properties_testable_with_one_sided_error}]
        Every hereditary graph property is testable (with one-sided error).
    \end{theorem}

    Although constant with respect to the size of the input graph, the query complexity of the resulting $\epsilon$-test
    from Alon \& Shapira Theorem is very large.
    This is due to the tower function bound of Szemer\'edi's Regularity Lemma, which is unavoidable in the general setting.
    Another problem caused by the use of the Regularity Lemma, although less concerning, is generated by the presence of
    irregular pairs.
    Due to this, a subsequent refinement of the resulting partition is required, further increasing the complexity
    of the tester.

    Now, by moving to the context of stable graphs, both these difficulties are easily avoided by using the
    Stable Regularity Lemma instead.
    The partition size is only exponential with respect to the error parameter $\epsilon$, and irregular pairs are
    completely avoided. \todo{Mention homogeneity?}

    The remaining of this section will be dedicated to the construction of an $\epsilon$-test for a known case
    of hereditary property, \emph{$H$-freeness} in stable graphs.
    A graph $G$ is said to be $H$-free, where $H$ is another graph, if no copy of $H$ appears as an induced subgraph in $G$.
    Thus, the given $\epsilon$-test needs to be able to distinguish between graphs that are $H$-free and graphs that
    are $\epsilon$-far from it, with some error.
    In fact, our $\epsilon$-test will only have one-sided error, as if the input graph is $H$-free the tester will
    report so with probability $1$.

    The first step towards constructing such tester is proving \Cref{lem:property_testing_with_stable_partitions}.
    This lemma uses the Stable Regularity Lemma to prove in the context of stable graphs, that a graph being $\epsilon$-far
    from being $H$-free implies it containing many (as a fixed fraction of all induced subgraphs of size $|H|$)
    induced copies of $H$.
    This point is central for the construction, and once proved we can simply let the tester ask for all the edges
    in a sample of vertices of fixed size.
    The algorithm then simply checks whether a copy of $H$ can be found in the subgraph induced by the sample, and report
    accordingly.

    \begin{definition} \label{def:unavoidable}
        A graph $H$ is \emph{$\gamma$-unavoidable} in a graph $G$ if no adding or removing of up to $\epsilon {|G| \choose 2}$
        edges in $G$ results in $H$ not appearing as an induced subgraph of $G$.
    \end{definition}

    \begin{definition} \label{def:abundant}
        A graph $H$ is \emph{$\eta$-abundant} in a graph $G$ if $G$ contains at least $\eta |G|^{|H|}$
        induced copies of $H$.
    \end{definition}

    \begin{lemma}[Lemma 3.1,~\cite{efficient_testing_of_large_graphs}] \label{lem:regularity_is_transitive}
        Let $\epsilon \leq \epsilon' < \frac{1}{2}$ and $\delta \in \parround{0, 1}$.
        If $\parround{A,B}$ is an $\epsilon$-regular pair with density $\delta$, and $A' \in [A]^{\geq \epsilon' |A|}$,
        $B' \in [B]^{\geq \epsilon' |B|}$, then $\parround{A', B'}$ is an $\parround{\frac{\epsilon}{\epsilon'}}$-regular
        pair with density at least $\delta - \epsilon$ and at most $\delta + \epsilon$.
        \begin{proof}
            Let $A'' \subseteq A' \subseteq A$, $B'' \subseteq B' \subseteq B$ be such that
            \begin{align*}
                |A''| & \geq \frac{\epsilon}{\epsilon'} |A'| \geq \frac{\epsilon}{\epsilon'} \epsilon' |A| = \epsilon |A|
                \text{ and } \\
                |B''| & \geq \frac{\epsilon}{\epsilon'} |B'| \geq \frac{\epsilon}{\epsilon'} \epsilon' |B| = \epsilon |B|
            \end{align*}
            By $\epsilon$-regularity of $\parround{A,B}$, $\parstraight{d(A,B) - d(A'',B'')} < \epsilon$.
            Thus,
            \begin{align*}
                \parstraight{d(A',B') - d(A'',B'')}
                    & = \parstraight{d(A',B') - d(A,B) + d(A,B) - d(A'',B'')} \\
                    & \leq \parstraight{d(A',B') - d(A,B)} + \parstraight{d(A,B) - d(A'',B'')} \\
                    & < 2 \epsilon \leq \frac{\epsilon}{\epsilon'}
            \end{align*}
            This proves the $\parround{\frac{\epsilon}{\epsilon'}}$-regularity of $\parround{A',B'}$.

            Also, since $\parround{A,B}$ is $\epsilon$-regular, $\parstraight{d(A,B) - d(A',B')} < \epsilon$,
            and thus,
            \[
                \delta - \epsilon < d(A',B') < \delta + \epsilon
            \]
        \end{proof}
    \end{lemma}

    \begin{lemma}[Lemma 3.2,~\cite{efficient_testing_of_large_graphs}] \label{lem:H_like_partition_implies_H_abundance}
        For every $\delta \in \parround{0, 1}$ and $\ell > 0$ there exist $\epsilon = \epsilon \parround{\delta, \ell}$ and
        $\eta = \eta \parround{\eta, \ell}$ satisfying the following property:

        Let $H$ be a graph with vertices $v_1, \dots,v_\ell$ and let $V_1, \dots, V_\ell$ be an $\ell$-tuple of disjoint
        sets of vertices of a graph $G$ such that for every $1 \leq i < i' \leq \ell$, the pair $\parround{V_i, V_{i'}}$
        is $\epsilon$-regular, with density at least $\delta$ if $v_i v_{i'}$ is an edge of $H$, and at most $1 - \delta$
        if $v_i v_{i'}$ is not an edge of $H$.
        Then, at least $\eta \prod_{i=1}^\ell \parstraight{V_i}$ of $\ell$-tuples $w_1 \in V_1, \dots, w_\ell \in V_\ell$
        span induced copies of $H$ where $w_i$ plays the role of $v_i$.
        \begin{proof}
            Without loss of generality, we assume that $H$ is the complete graph, since we can simply replace each non-edge
            $v_i v_{i'}$ of $H$ with an edge by exchanging all edges and non-edges between $V_i$ and $V_{i'}$.

            We prove the lemma by induction on $\ell$.
            The case $k=1$ is trivial, and the number of induced copies of $H$ is $|V_1|$, so $\eta(\delta, 1) = 1$ and
            $\epsilon(\delta, 1) = 1$ (No regularity needed if no pairs).
            The I.H. is that the values $\eta(\delta, \ell-1)$ and $\epsilon(\delta, \ell-1)$ exist and are known for all
            $\ell$.
            We proceed to prove that the following values $\eta$ and $\epsilon$ hold:
            \begin{align*}
                \epsilon &= \epsilon(\delta, \ell)
                    = \min \parround{\frac{1}{2\ell - 2}, \frac{1}{2} \delta \epsilon(\frac{1}{2}\delta, \ell-1)} \\
                \eta &= \eta(\delta, \ell)
                    = \frac{1}{2} (\delta - \epsilon)^{\ell-1} \eta(\frac{1}{2}\delta, \ell-1)
            \end{align*}
            For each $1 < i \leq \ell$, the number of vertices of $V_1$ which have less then
            $(\delta - \epsilon) \parstraight{V_i}$ neighbors in $V_i$ is less then $\epsilon \parstraight{V_i}$.
            Otherwise, the set of such vertices, say $U \in [V_1]^{\geq \epsilon \parstraight{V_1}}$ together with $V_i$
            would form a subpair $\parround{U, V_i}$ with density $< \delta - \epsilon$ which, by
            \Cref{lem:regularity_is_transitive} contradicts the $\epsilon$-regularity of the pair $\parround{V_1, V_i}$.

            Therefore, at least $(1 - (\ell -1) \epsilon) \parstraight{V_1}$ of the vertices of $V_1$ have at least
            $(\delta - \epsilon) \parstraight{V_i}$ neighbors in $V_i$ for all $1 < i \leq \ell$.
            In particular, since $\epsilon \leq \frac{1}{2\ell - 2}$ we have that $(\ell - 1) \epsilon \leq \frac{1}{2}$
            and then $1 - (\ell - 1) \epsilon \geq \frac{1}{2}$, so at least half of the vertices of $V_1$ satisfy the
            above condition.

            For each such vertex $w_1 \in V_1$, let $V_i'$ denote the subset of vertices of $V_i$ which are neighbors
            of $w_1$.
            Since $epsilon \leq \frac{1}{2}\delta$, \Cref{lem:regularity_is_transitive} implies that for all
            $1 < i < i' \leq \ell$, the pair $\parround{V_i', V_{i'}'}$ is $\parround{\frac{\epsilon}{\delta-\epsilon}}$-regular,
            and given that $\parround{\frac{\epsilon}{\delta-\epsilon}} \leq \parround{\frac{2\epsilon}{\delta}} \leq \epsilon\parround{\frac{1}{2}\delta, \ell-1}$,
            it is $\epsilon\parround{\frac{1}{2}\delta, \ell-1}$-regular.
            Also, it has density at least $\delta - \epsilon \geq \frac{1}{2} \delta$.
            By the induction hypothesis, we have at least
            \[
                \eta \parround{\frac{1}{2}\delta, \ell-1} \prod_{i=2}^\ell \parstraight{V_i'}
                    \geq \eta \parround{\frac{1}{2}\delta, \ell-1} \prod_{i=2}^\ell \parround{\delta - \epsilon} \parstraight{V_i}
            \]
            possible choices of $w_2 \in V_2, \dots, w_\ell \in V_\ell$ such that the induced subgraph spanned by
            $w_1, \dots, w_\ell$ is complete.
            Since there are at least $\frac{1}{2} \parstraight{V_1}$ vertices $w_1$ which satisfy the above condition,
            the chosen values of $\eta$ satisfies the lemma, and we are done.
        \end{proof}
    \end{lemma}

    \begin{remark}
        The non-recursive form of $\epsilon$ and $\eta$ for $\ell > 1$ is:
        \begin{align*}
            \epsilon(\delta, \ell) & = 2 \parround{\frac{\delta}{4}}^{\ell-1} \\
            \eta(\delta, \ell) & \geq \frac{1}{2^{\frac{(\ell+2)(\ell+1)}{2}-4}} \delta^{\frac{\ell(\ell-1)}{2}}
        \end{align*}
    \end{remark}

    \begin{theorem} \label{lem:property_testing_with_stable_partitions}
        For every $k_*, \gamma, \ell$ there is a $\eta(k_*, \gamma, \ell)$ such that if $H$ is a graph with $\ell$
        vertices, $G$ has the non-$k_*$-order property and $H$ is $\gamma$-unavoidable in $G$, then $H$ is
        $\eta$-abundant in $G$.
        \begin{proof}
            Apply \Cref{thm:existance_of_regular_partitions} to $G$ with $\epsilon = \min \parround{\frac{\sqrt{\gamma}}{2},
                \frac{\epsilon_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell}}{\ell}}$,
            $k_*$ and $m=0$.
            We have a partition $\overline{A} = \parcurly{A_i \mid i \in \parcurly{1, \dots, m_+}}$ into $m_* \leq M$
            disjoint parts with,
            \[
                M \leq \ceil{12 \max\parround{\frac{2}{\sqrt{\gamma}}, \frac{\ell}{\epsilon_{\ref{lem:H_like_partition_implies_H_abundance}}
                    \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell}}}}^{2^{k_*+1}-1}
            \]
            such that all pairs of parts are $\epsilon$-regular, and self-pairs are $4 \epsilon$-regular.
            Also, by \Cref{rmk:excellence_imply_little_exceptions} and $\frac{\epsilon^2}{2}$-excellence of the parts,
            pairs have density at most $\epsilon^2$ or at least $1 - \epsilon^2$. \todo{Maybe make a remark in Theorem 5.19}

            Now, we randomly partition each part $A_i$ into $\ell$ equitable subparts $A_{i,j}$.
            By \Cref{lem:regularity_is_transitive}, each pair of such subparts is $\ell \epsilon$-regular.
            On the other hand, \Cref{thm:existance_of_regular_partitions} guarantees that such pairs have density
            at most $\epsilon$ or at least $1 - \epsilon$.

            Next, we modify the graph $G$ into $G'$ by only adding and removing no more than $\gamma {|G| \choose 2}$
            edges:
            \begin{itemize}
                \item For each pair of parts $\parround{A_{i_1}, A_{i_2}}$ with $i_1 \neq i_2$, if the pair's density is
                    at most $\epsilon^2$, we remove all edges between $A_{i_1}$ and $A_{i_2}$.
                    Otherwise, the pair's density is at least $1 - \epsilon^2$, and we add all remaining edges.
                    This changes at most a fraction $\epsilon^2$ of the edges between (disjoint) parts.
                \item For each self-pair $\parround{A_i, A_i}$, if the pair's density is at most $4 \epsilon^2$ again we
                    remove all edges in $A_i$.
                    Otherwise, the pair's density is at least $1 - 4 \epsilon^2$, and we add all remaining edges.
                    This changes at most a fraction $4 \epsilon^2$ of the edges in self-pairs.
            \end{itemize}
            The resulting graph $G'$ differs from $G$ in at most $4 \epsilon^2 {|G| \choose 2} \leq \gamma {|G| \choose 2}$
            edges.
            Thus, the $\gamma$-unavoidability of $H$ in $G$ ensures that there is still a copy of $H$ in $G'$.
            Denote its vertices $v_{i_1}, \dots, v_{i_\ell}$, choosing $i_1, \dots, i_\ell$ such that
            $v_{i_1} \in A_{i_1,1}, \dots, v_{i_\ell} \in A_{i_\ell, \ell}$.
            Notice that $A_{i_1,1}, \dots, A_{i_\ell, \ell}$ satisfy the conditions of \Cref{lem:H_like_partition_implies_H_abundance}
            with $\delta_{\ref{lem:H_like_partition_implies_H_abundance}} = 1 - \frac{\sqrt{\gamma}}{2}$:
            \begin{itemize}
                \item Each subpair $\parround{A_{i_j, j}, A_{i_{j'}, j'}}$ with $j \neq j'$ is $\ell \epsilon$-regular,
                    and since $\epsilon \leq \frac{\epsilon_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell}}{\ell}$,
                    in particular is $\epsilon_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell}$-regular.
                \item For each $i_j \neq i_{j'}$, if $v_{i_j} v_{i_{j'}}$ is an edge of $G$ then, by construction of $G'$,
                    the subpair $\parround{A_{i_j, j}, A_{i_{j'}, j'}}$ has density at least $1 - \epsilon \leq 1 - \frac{\sqrt{\gamma}}{2}$,
                    and if $v_{i_j} v_{i_{j'}}$ is not an edge of $G$, the subpair $\parround{A_{i_j, j}, A_{i_{j'}, j'}}$
                    has density at most $\epsilon \geq 1 - \parround{1 - \frac{\sqrt{\gamma}}{2}}$
            \end{itemize}
            The lemma guarantees that there are at least $\eta_{\ref{lem:H_like_partition_implies_H_abundance}}
                \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell} \prod_{j=1}^\ell \parcurly{A_{i_j},j}$
            copies of $H$ in $G$.
            The fraction of induced copies of $H$ in $G$ is at least
            \[
                \frac{\eta_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell}
                    \prod_{j=1}^\ell \parcurly{A_{i_j},j}}{n^\ell}
                    \geq \eta_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell}
                        \parround{\frac{\frac{n}{M \cdot \ell}}{n}}^{\ell}
                    = \eta_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \frac{\sqrt{\gamma}}{2}, \ell}
                        \parround{M \cdot \ell}^{-\ell}
                    \eqqcolon \eta
            \]
            and $H$ is at least $\eta$-abundant in $G$.
        \end{proof}
    \end{theorem}

    Notice that this same result can be proved in the general context instead of only for stable graphs
    as shown in Theorem 5.1 from~\cite{efficient_testing_of_large_graphs}.
    The difference is that the resulting $\eta$ is much larger (although not given explicitly).

    \begin{remark}
        A more explicit lower bound for $\eta$ only depending on $\gamma$, $k_*$ and $\ell$ is:
        \[
            \eta \geq \frac{1}{2^{\frac{(\ell+2)(\ell+1)}{2}-4}} \parround{1 - \frac{\sqrt{\gamma}}{2}}^{\frac{\ell(\ell-1)}{2}}
                \bbparround{\frac{1}{24} \min\bparround{\frac{\sqrt{\gamma}}{2},
                    \frac{2}{\ell} \parround{\frac{2 - \sqrt{\gamma}}{8}}^{\ell-1}}}^{\ell \parround{2^{k_*+1}-1}}
                \parround{\frac{1}{\ell}}^{\ell}
        \]
    \end{remark}

    Now we have all the tools to build our $\epsilon$-test $\mathcal{A}$ for deciding $H$-freeness for a given graph $H$
    of size $\ell$.
    See \Cref{alg:h-freeness_tester} to see the steps of the algorithm.

    \begin{algorithm}[H]
        \caption{$\epsilon$-test $\mathcal{A}$ for deciding $H$-freeness for a given graph $H$ of size $\ell$}
        \label{alg:h-freeness_tester}
        \begin{algorithmic}[1]
            \Require a graph $G$ of size $n$ with non-$k_*$-order property
            \If{$n < \ell$}
                \State return 0 \label{line:G_smaller_then_H}
            \Else
                \While{$i \leq \frac{2}{3}\frac{1}{\eta_{\ref{lem:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)}$}
                    \State $S_i = \parcurly{s_{i,1}, \dots, s_{i,\ell}}$ such that $s_{i,j} \sim G$
                    \State query all edges from induced subgraph $S_i$
                    \If{$S_i \cong H$}
                        \State return 1 \label{line:found_H}
                    \EndIf
                \EndWhile
                \State return 0 \label{line:not_found_H}
            \EndIf
        \end{algorithmic}
    \end{algorithm}

    Indeed, $\mathcal{A}$ is an $\epsilon$-test.
    If the input graph $G$ is $H$-free, then the algorithm returns $0$, either because the graph $G$ it too small to
    contain $H$ (\cref{line:G_smaller_then_H}) or because all attempts of finding $H$ as an induced subgraph of $G$
    failed (\cref{line:not_found_H}).
    On the other hand, if $G$ is $\epsilon$-far from being $H$-free, \Cref{lem:property_testing_with_stable_partitions}
    ensures that $H$ is $\eta_{\ref{lem:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)$-abundant in $G$.
    Thus, the probability that $\mathcal{A}$ finds one copy of $H$ during its completion (\cref{line:found_H}) is at least:
    \[
        \sum_{i=1}^{\frac{2}{3}\frac{1}{\eta_{\ref{lem:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)}}
                P\parround{S_i \text{ is an induced copy of } H \text{ in } G}
            \geq
    \]

    \jojo



    % up to here it was compiling with no problem.
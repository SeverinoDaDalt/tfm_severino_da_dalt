\section{Property Testing} \label{sec:section_6}

    Property testing is a field of theoretical computer science, concerned about finding low-complexity algorithms
    for testing (approximate) properties in large objects, such as graphs.
    These algorithms need to be successful with high probability, and are only required to distinguish between objects
    that do not satisfy the property, and those which are \say{far} from satisfying it.
    For the purposes of this thesis, it is useful to formalize these concepts in the context of graphs.

    \begin{definition}
        We say that a graph $G$ is \emph{$\epsilon$-far} from satisfying a graph property $\mathcal{P}$ if no adding or
        removing of up to $\epsilon {|G| \choose 2}$ edges in $G$ results in the graph satisfying the property.
    \end{definition}

    \begin{definition} \label{def:epsilon_test}
        An \emph{$\epsilon$-test} $\mathcal{A}$ deciding a graphs property $\mathcal{P}$ with query complexity
        $q(n)$ is a randomized algorithm that, on input graph $G$ of size $n$,
        satisfies:
        \begin{enumerate}
            \item If $G \in \mathcal{P}$, then $P\parround{\mathcal{A} \text{ accepts } G} \geq \frac{2}{3}$.
            \item If $G$ is $\epsilon$-far from satisfying $\mathcal{P}$,
                then $P\parround{\mathcal{A} \text{ rejects } G} \geq \frac{2}{3}$.
        \end{enumerate}
        The query complexity $q(n)$ is the maximum number of queries the algorithm can make, and (in our case)
        a query discerns whether a desired pair of vertices in the input graph $G$ are adjacent or not.
    \end{definition}

    Of course, the most desirable testers are those with lower query complexity.
    A class of particular interest is that of testers whose complexity does not grow with the size of the
    graph $G$.

    \begin{definition}
        We say that a property $\mathcal{P}$ is \emph{testable} if there exists an $\epsilon$-test deciding $\mathcal{P}$
        with a constant query-complexity with respect to the size of the input graph, that is, it only depends on the
        parameter $\epsilon$.
    \end{definition}

    In~\cite{a_characterization_of_the_natural_graph_properties_testable_with_one_sided_error}, Alon and Shapira
    showed that a large class of properties, a subclass of which will be the center of our attention, are testable.

    \begin{theorem}[Alon \& Shapira Theorem in~\cite{a_characterization_of_the_natural_graph_properties_testable_with_one_sided_error}]
        \label{thm:alon_and_shapira_theorem}
        Every hereditary graph property is testable (with one-sided error).
    \end{theorem}

    A property is said to be \emph{hereditary} if it is preserved under taking induced subgraphs.
    A property is testable \emph{with one-sided error} if the first condition in \Cref{def:epsilon_test}
    is strengthened to $P\parround{\mathcal{A} \text{ accepts } G} = 1$, and thus the associated algorithm does
    not give false negatives.

    Towards Alon \& Shapira Theorem,~\cite{efficient_testing_of_large_graphs} shows that \emph{$H$-freeness} is testable.
    A graph $G$ is said to be $H$-free, where $H$ is another graph, if no copy of $H$ appears as an induced subgraph in $G$.
    Clearly, $H$-freeness is an hereditary property, and it will be the focus of our attention later in the section.

    Both~\cite{} and~\cite{} made use of what it has become known as the ‘Strong Regularity lemma’.
    The Strong Regularity Lemma is a stronger version of Szemer\'edi's Regularity Lemma.
    It features a partition and one refinement of it, both regular, with the second having a stronger regularity then
    the first one.
    The partition's regularity can be any given value, and the refinement's regularity is a function
    on the number of pairs of the first partition.
    Again, such function can be any \say{reasonable} one (See~\cite{efficient_testing_of_large_graphs}[Lemma 4.1]).
    The goal of this strenghthened version of the regularity lemma is to be able to deal with the counting of the
    induced copies of graphs within G. Indeed, in the usual regularity lemma, theorem ~\ref{}, there are irregular
    pairs of clusters.
    Recall that these irregular pairs are unavoidable (see the comment in the introduction, due to the possible presence
    of a large half-graph).
    Since there is no control on the edges of the irregular pairs (the only information is that they are not regular,
    which is not very restrictive), it is hard to know how the induced copies behave when some of the edges or non-edges
    should belong to these irregular pairs.
    See … (put the example of the irregular pairs from the book of Zhao, or put the example that we developed regarding
    the induced path with 4 vertices), where each modification of the edges withing the irregular pair will shift
    induced copies of $P_4$, and thus, it is not completely clear how to eliminate those copies.

    In order to solve these technical challanges, Alon …. and Szegedy \cite[Theorem~]{} applied the regularity lemma
    twice, refining an already regular partition, in order to gain control on most of the parts of the refined
    (aquí pots explicar amb una mica de bla bla bla l statement).
    However, this implies that the number of parts in the final refinement increases.
    \footnote{As the reader might have guess, there is a \emph{weak} version of the regularity lemma, in which the
        number of parts is much smaller, but less information can be gathered from the partition. This result can be found
        in \cite{} and, together with the regular and the strong version of the regularity lemma, can be seen as one of a
        sequence of many possible regularity lemmas with varying strength \cite{regulary lemma for the analyst, lov szegedy}.}

    %%%%
    This requires the use of the so-called Strong Regularity Lemma\footnote{It is a
        stronger version of Szemer\'edi's Regularity Lemma, and it is shown in Lemma 4.1 of~\cite{efficient_testing_of_large_graphs}.
        It features a partition and one refinement of it, both regular,
        with the second having a stronger regularity then the first one.
        The partition's regularity can be any given value, and the refinement's regularity is a function
        on the number of pairs of the first partition.
        Again, such function can be any \say{reasonable} one.},
    which aims at dealing with the irregular
    pairs from the original version, of which edges we know nothing and thus hinder property testing.
    It uses a double partitioning of the vertex set in order to obtain a family of disjoint sets
    with no irregular pairs.
    This double partition increases the number of parts, and thus the query complexity of the associated tester, which
    is already extremely large, although constant, due to the tower of powers function bound which unavoidable in the
    general setting~\cite{lower_bounds_of_tower_type_for_szeremedis_uniformity_lemma}.
    Then, \Cref{thm:alon_and_shapira_theorem} is a generalization of the results for $H$-freeness to all
    hereditary properties.
    %%%%

    A natural solution in order to avoid such immense bound from the Regularity Lemma is to restrict the problem
    to a favorable class of graphs, for example, restricting to the class of graphs with bounded VC-dimension
    (See \Cref{def:VC_dimension}).
    %%START
    In the context of bipartite graphs with bounded VC-dimension,~\cite{efficient_testing_of_bipartite_graphs_for_forbidden_induced_subgraphs}
    shows a family of regularity lemmas (from weaker to stronger than the Szemer\'edi's) which bound on the number of parts
    is only polynomial in $\epsilon^{-1}$.
    %%END

    A first result in that direction, with the focuss on bipartite graphs, appeared in \cite{??}, where the bound on the
    number of parts of the regular partition is greatily improved, and also the information that each regular pair
    is either almost or almost empty of edges is given.
    The version where no restriction was placed on the graph G was given in \cite{??},
    and the one with the best bounds in this context is given by
    the~\cite[theorem ..]{fox suk…},
    which we quote below;

    \begin{theorem}
    \end{theorem}

    i hi poses les cotes.

    The author uses the stronger version to prove testability of $H$-freeness, with a much lower query complexity.
    \todo{Lluis, imagino que no ho diu aixó ultim al paper, pero está clar que baixa, no?}
    Then,~\cite{??} shows a similar result but generalizing to all graphs with bounded VC-dimension,
    and~\cite{erdos_hajnal_conjecture_for_graphs_with_bounded_vc_dimension} improves this bound further.
    These last two results use the so-called Ultra Strong Regularity Lemma, in which (most of) the resulting partition
    pairs have density either at most $\epsilon$ or at least $1 -\epsilon$, which they call \say{$\epsilon$-homogeneous}.

    %%START
    Still, the class of graphs with bounded VC-dimension does not avoid irregular pairs, and thus neither avoids
    the associated increase in parts when further refining the partition when proving the testability of $H$-freeness
    (which is a standard procedure to deal with such pairs~\cite{efficient_testing_of_large_graphs}).
    %%END

    Note that, even with the problem of getting better bounds in the regularity lemma addressed, the regular partitions
    of graphs with bounded VC-dimension may contain irregular pairs (Indeed, the half-graph itself has bounded
    VC-dimension).
    The lack of irregular pairs in the class of stable graphs, allows us to use Theorem~\ref{??}
    (regularity lemma for stable graphs) to give an straightforward argument that proves that  being (induced)
    H-free is testable, with one-sided error, with some explicit (and more reasonable) bounds than the ones given by
    Theorem~\ref{??} (alon shapira).
    The algorithm is given as Algorithm 1, the proof of the correctness and its explanation is given just before.
    Let us remark that using l’esquema de l’Alon-…szegedy usant el resultat per la bounded VC.-dimension, one could be
    able to obtain bounds on the … of the type … which are better than … For further discussion the reader is referred
    to the end of the section (posarem alguna cosa per dir que el del irregular pairs, de fet, permet dir més).

    Now, by moving to a subclass of graphs with bounded VC-dimension, the class of stable graphs,
    all these difficulties are easily avoided by using the Stable Regularity Lemma instead.
    The partition size is only a double exponential of the error parameter $\epsilon$, irregular pairs are
    completely avoided, and all pairs are also $\epsilon$-homogeneous.
    It needs to be noted that in the Stable Regularity Lemma the exponent of $\epsilon^{-1}$ in the bound of the number
    of parts is an exponential on the size of the avoided half-graph, against the lower polynomial exponent of the
    Ultra Strong Regularity Lemma.
    It is an open problem whether the bound from the Stable Regularity Lemma can be improved~\cite{julia_cositas}.

    The remaining of this section will be dedicated to the construction of an $\epsilon$-test for $H$-freeness in stable graphs.
    %A graph $G$ is said to be $H$-free, where $H$ is another graph, if no copy of $H$ appears as an induced subgraph in $G$.
    Such an $\epsilon$-test needs to be able to distinguish between graphs that are $H$-free and graphs that
    are $\epsilon$-far from it, with some error.
    In fact, our $\epsilon$-test will only have one-sided error, as if the input graph is $H$-free the tester will
    report so with probability $1$.

    The first step towards constructing such tester is proving \Cref{thm:property_testing_with_stable_partitions}.
    This theorem uses the Stable Regularity Lemma to prove that a graph being $\epsilon$-far
    from being $H$-free implies it containing many (as a fixed fraction of all induced subgraphs of size $|H|$)
    induced copies of $H$.
    This point is central for the construction, and once proved we can simply let the tester ask for all the edges
    in a sample of vertices of fixed size.
    The algorithm then simply checks whether a copy of $H$ can be found in the subgraph induced by the sample, and report
    accordingly.

    \subsection{Unavoidable is Abundant} \label{subsec:subsection_6.1}

        We now briefly formalize the concepts of being far from $H$-freeness, and containing many copies of $H$ using the
        notation from~\cite{efficient_testing_of_large_graphs}.

        \begin{definition} \label{def:unavoidable}
            A graph $H$ is \emph{$\gamma$-unavoidable} in a graph $G$ if no adding or removing of up to $\gamma {|G| \choose 2}$
            edges in $G$ results in $H$ not appearing as an induced subgraph of $G$.
        \end{definition}

        \begin{definition} \label{def:abundant}
            A graph $H$ is \emph{$\eta$-abundant} in a graph $G$ if $G$ contains at least $\eta |G|^{|H|}$
            induced copies of $H$.
        \end{definition}

        An important property of regularity, which is needed for the proof of the theorem, is that the regularity is
        partially maintained when moving to subsets.
        Not only that, but it also ensures that the density of the pair does not change too much.
        \todo{Possibly move this to section 2.}

        \begin{lemma}[Lemma 3.1 in~\cite{efficient_testing_of_large_graphs}] \label{lem:regularity_is_transitive}
            Let $\epsilon \leq \epsilon' < \frac{1}{2}$ and $\delta \in \parround{0, 1}$.
            If $\parround{A,B}$ is an (not necessarily disjoint) $\epsilon$-regular pair with density $\delta$, $A' \subseteq A$ with
            $A \geq \epsilon' |A|$, and $B' \subseteq B$ with $|B'| \geq \epsilon' |B|$, then $\parround{A', B'}$ is an
            $\parround{\frac{\epsilon}{\epsilon'}}$-regular pair with density at least $\delta - \epsilon$ and at most $\delta + \epsilon$.
            \begin{proof}
                Let $A'' \subseteq A' \subseteq A$, $B'' \subseteq B' \subseteq B$ be such that
                \begin{align*}
                    |A''| & \geq \frac{\epsilon}{\epsilon'} |A'| \geq \frac{\epsilon}{\epsilon'} \epsilon' |A| = \epsilon |A|
                    \text{ and } \\
                    |B''| & \geq \frac{\epsilon}{\epsilon'} |B'| \geq \frac{\epsilon}{\epsilon'} \epsilon' |B| = \epsilon |B|
                \end{align*}
                By $\epsilon$-regularity of $\parround{A,B}$, $\parstraight{d(A,B) - d(A'',B'')} < \epsilon$.
                Thus,
                \begin{align*}
                    \parstraight{d(A',B') - d(A'',B'')}
                        & = \parstraight{d(A',B') - d(A,B) + d(A,B) - d(A'',B'')} \\
                        & \leq \parstraight{d(A',B') - d(A,B)} + \parstraight{d(A,B) - d(A'',B'')} \\
                        & < 2 \epsilon \leq \frac{\epsilon}{\epsilon'}
                \end{align*}
                This proves the $\parround{\frac{\epsilon}{\epsilon'}}$-regularity of $\parround{A',B'}$.

                Also, since $\parround{A,B}$ is $\epsilon$-regular, $\parstraight{d(A,B) - d(A',B')} < \epsilon$,
                and thus,
                \[
                    \delta - \epsilon < d(A',B') < \delta + \epsilon
                \]
            \end{proof}
        \end{lemma}

        The pivotal point in the proof of \Cref{thm:property_testing_with_stable_partitions} is the fact that, if the
        reduced graph \todo{Define reduced subgraph as a remark of the stable regularity lemma.} from a regular partition contains an induced structure resembling $H$, i.e. where pairs of parts are
        mostly connected if the corresponding vertices in $H$ are connected, and mostly not connected otherwise,
        then the original graph contains many induced copies of $H$ (this is a version of the so called \emph{Counting Lemma}
        from~\cite{the_regulariy_lemma_and_its_applications_in_graph_theory}).
        The following lemma formalizes this idea.

        \begin{lemma}[Lemma 3.2 in~\cite{efficient_testing_of_large_graphs}] \label{lem:H_like_partition_implies_H_abundance}
            For every $\delta \in \parround{0, 1}$ and $\ell > 0$ there exist $\epsilon = \epsilon \parround{\delta, \ell}$ and
            $\eta = \eta \parround{\delta, \ell}$ satisfying the following property:

            Let $H$ be a graph with vertices $v_1, \dots,v_\ell$ and let $V_1, \dots, V_\ell$ be an $\ell$-tuple of (not necessarily disjoint)
            sets of vertices of a graph $G$ such that for every $1 \leq i < i' \leq \ell$, the pair $\parround{V_i, V_{i'}}$
            is $\epsilon$-regular, with density at least $\delta$ if $v_i v_{i'}$ is an edge of $H$, and at most $1 - \delta$
            if $v_i v_{i'}$ is not an edge of $H$.
            Then, at least $\eta \prod_{i=1}^\ell \parstraight{V_i}$ of $\ell$-tuples $w_1 \in V_1, \dots, w_\ell \in V_\ell$
            span induced copies of $H$ where $w_i$ plays the role of $v_i$.
            \begin{proof}
                Without loss of generality, we assume that $H$ is the complete graph, since we can simply replace each non-edge
                $v_i v_{i'}$ of $H$ with an edge by exchanging all edges and non-edges between $V_i$ and $V_{i'}$.

                We prove the lemma by induction on $\ell$.
                The case $\ell=1$ is trivial, and the number of induced copies of $H$ is $|V_1|$, so $\eta(\delta, 1) = 1$ and
                $\epsilon(\delta, 1) = 1$ (No regularity needed if no pairs).
                The I.H. is that the values $\eta(\delta, \ell-1)$ and $\epsilon(\delta, \ell-1)$ exist and are known for all
                $\ell$.
                We proceed to prove that the following values $\eta$ and $\epsilon$ hold:
                \begin{align*}
                    \epsilon &= \epsilon(\delta, \ell)
                        = \min \bbparround{\frac{1}{2\ell - 2}, \frac{1}{2} \delta \epsilon(\frac{1}{2}\delta, \ell-1)} \\
                    \eta &= \eta(\delta, \ell)
                        = \frac{1}{2} (\delta - \epsilon)^{\ell-1} \eta(\frac{1}{2}\delta, \ell-1)
                \end{align*}
                For each $1 < i \leq \ell$, the number of vertices of $V_1$ which have less then
                $(\delta - \epsilon) \parstraight{V_i}$ neighbors in $V_i$ is less then $\epsilon \parstraight{V_i}$.
                Otherwise, the set of such vertices, say $U \in [V_1]^{\geq \epsilon \parstraight{V_1}}$ together with $V_i$
                would form a subpair $\parround{U, V_i}$ with density $< \delta - \epsilon$ which, by
                \Cref{lem:regularity_is_transitive} contradicts the $\epsilon$-regularity of the pair $\parround{V_1, V_i}$.

                Therefore, at least $(1 - (\ell -1) \epsilon) \parstraight{V_1}$ of the vertices of $V_1$ have at least
                $(\delta - \epsilon) \parstraight{V_i}$ neighbors in $V_i$ for all $1 < i \leq \ell$.
                In particular, since $\epsilon \leq \frac{1}{2\ell - 2}$ we have that $(\ell - 1) \epsilon \leq \frac{1}{2}$
                and then $1 - (\ell - 1) \epsilon \geq \frac{1}{2}$, so at least half of the vertices of $V_1$ satisfy the
                above condition.

                For each such vertex $w_1 \in V_1$, let $V_i'$ denote the subset of vertices of $V_i$ which are neighbors
                of $w_1$.
                Since $\epsilon \leq \frac{1}{2}\delta$, \Cref{lem:regularity_is_transitive} implies that for all
                $1 < i < i' \leq \ell$, the pair $\parround{V_i', V_{i'}'}$ is $\parround{\frac{\epsilon}{\delta-\epsilon}}$-regular,
                and given that $\parround{\frac{\epsilon}{\delta-\epsilon}} \leq \parround{\frac{2\epsilon}{\delta}} \leq \epsilon\parround{\frac{1}{2}\delta, \ell-1}$,
                it is $\epsilon\parround{\frac{1}{2}\delta, \ell-1}$-regular.
                Also, it has density at least $\delta - \epsilon \geq \frac{1}{2} \delta$.
                By the induction hypothesis, we have at least
                \[
                    \eta \parround{\frac{1}{2}\delta, \ell-1} \prod_{i=2}^\ell \parstraight{V_i'}
                        \geq \eta \parround{\frac{1}{2}\delta, \ell-1} \prod_{i=2}^\ell \parround{\delta - \epsilon} \parstraight{V_i}
                \]
                possible choices of $w_2 \in V_2, \dots, w_\ell \in V_\ell$ such that the induced subgraph spanned by
                $w_1, \dots, w_\ell$ is complete.
                Since there are at least $\frac{1}{2} \parstraight{V_1}$ vertices $w_1$ which satisfy the above condition,
                the chosen values of $\eta$ satisfies the lemma, and we are done.
            \end{proof}
        \end{lemma}

        \begin{remark}
            The non-recursive form of $\epsilon$ and $\eta$ for $\ell > 1$ is:
            \begin{align*}
                \epsilon(\delta, \ell) & = \bbparround{\frac{1}{2}}^{\frac{\ell(\ell-1)}{2}} \cdot \delta^{\ell-1} \\
                \eta(\delta, \ell) & \geq \bbparround{\frac{1}{2}}^{\frac{\ell^3+5\ell-6}{6}} \cdot \delta^{\frac{\ell(\ell-1)}{2}}
            \end{align*}
        \end{remark}

        We are now ready to prove the main theorem of this section.
        The proof is similar to that of~\cite[Theorem~5.1]{efficient_testing_of_large_graphs},
        but with some major simplification and optimization allowed by using the Stable Regularity Lemma.
        The main difference is the fact that we do not need to refine the partition to get rid of irregular pairs.
        To resume, we first apply \Cref{thm:existance_of_regular_partitions} to get a regular partition,
        then, we create a copy of the graph where pairs become either complete or empty, by adding or subtracting,
        overall, less than $\gamma {|G| \choose 2}$ edges.
        By the $\gamma$-unavoidability of $H$, this new graph still contains a copy of $H$.
        This fact ensures the existence of an induced structure in the partition of the original graph which allows
        us to apply \Cref{lem:H_like_partition_implies_H_abundance} and conclude that $H$ is abundant in $G$.
        Such conclusion is formalized in the following theorem.

        \begin{theorem} \label{thm:property_testing_with_stable_partitions}
            For every $k_*, \gamma, \ell$ there is a $\eta(k_*, \gamma, \ell)$ such that if $H$ is a graph with $\ell$
            vertices, $G$ has the non-$k_*$-order property and $H$ is $\gamma$-unavoidable in $G$, then $H$ is
            $\eta$-abundant in $G$.
            \begin{proof}
                Apply \Cref{thm:existance_of_regular_partitions} to $G$ with $\epsilon = \min \bparround{\sqrt{\gamma},
                    \epsilon_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \sqrt{\gamma}, \ell}}$,
                $k_*$ and $m=0$.
                We have a partition $\overline{A} = \bparcurly{A_i \mid i \in \parcurly{1, \dots, m_*}}$ into $m_* \leq M$
                disjoint parts with,
                \[
                    M \leq \ceil{12 \max\Parround{\frac{1}{\sqrt{\gamma}}, \frac{1}{\epsilon_{\ref{lem:H_like_partition_implies_H_abundance}}
                        \parround{1 - \sqrt{\gamma}, \ell}}}}^{2^{k_*+1}-1}
                \]
                such that all pairs of parts are $\epsilon$-regular.
                Also, by \Cref{rmk:excellence_imply_little_exceptions} and $\frac{\epsilon^2}{2}$-excellence of the parts,
                pairs have density at most $\epsilon^2$ or at least $1 - \epsilon^2$.

                Next, we modify the graph $G$ into $G'$ by only adding and removing no more than $\gamma {|G| \choose 2}$
                edges:
                \begin{itemize}
                    \item For each pair of parts $\parround{A_{i_1}, A_{i_2}}$ with $i_1 \neq i_2$, if the pair's density is
                        at most $\epsilon^2$, we remove all edges between $A_{i_1}$ and $A_{i_2}$.
                        Otherwise, the pair's density is at least $1 - \epsilon^2$, and we add all remaining edges.
                        This changes at most a fraction $\epsilon^2$ of the edges between (disjoint) parts.
                    \item For each self-pair $\parround{A_i, A_i}$, if the pair's density is at most $\epsilon^2$, again we
                        remove all edges in $A_i$.
                        Otherwise, the pair's density is at least $1 - \epsilon^2$, and we add all remaining edges.
                        Notice that, in self-pairs, the density ($1$ minus the density respectively) is at most
                        the fraction of possible edges in the pair that actually are edges (non-edges), as noted in
                        \Cref{rmk:density_vs_real_density}.
                        Thus, the fraction of changed edges in all self-pairs is at most $\epsilon^2$.
                \end{itemize}
                The resulting graph $G'$ differs from $G$ in at most $\epsilon^2 {|G| \choose 2} \leq \gamma {|G| \choose 2}$
                edges, and satisfies that each pair of parts (disjoint or not) is either complete or empty.
                Then, the $\gamma$-unavoidability of $H$ in $G$ ensures that there is still a copy of $H$ in $G'$.
                Denote its vertices $v_{i_1}, \dots, v_{i_\ell}$, choosing $i_1, \dots, i_\ell$ such that
                $v_{i_1} \in A_{i_1}, \dots, v_{i_\ell} \in A_{i_\ell}$.

                Notice that $A_{i_1}, \dots, A_{i_\ell}$ satisfy the conditions of \Cref{lem:H_like_partition_implies_H_abundance}
                with $\delta_{\ref{lem:H_like_partition_implies_H_abundance}} = 1 - \sqrt{\gamma}$:
                each pair $\parround{A_{i_j}, A_{i_{j'}}}$ with $j \neq j'$ is $\epsilon$-regular,
                and since $\epsilon \leq \epsilon_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \sqrt{\gamma}, \ell}$,
                in particular is $\epsilon_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \sqrt{\gamma}, \ell}$-regular.
                Hence, the lemma guarantees that there are at least $\eta_{\ref{lem:H_like_partition_implies_H_abundance}}
                    \parround{1 - \sqrt{\gamma}, \ell} \prod_{j=1}^\ell \parcurly{A_{i_j},j}$
                copies of $H$ in $G$.

                The fraction of induced copies of $H$ in $G$ is at least
                \[
                    \frac{\eta_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \sqrt{\gamma}, \ell}
                        \prod_{j=1}^\ell \parcurly{A_{i_j}}}{n^\ell}
                        \geq \eta_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \sqrt{\gamma}, \ell}
                            \bbparround{\frac{\frac{n}{M}}{n}}^{\ell}
                        = \eta_{\ref{lem:H_like_partition_implies_H_abundance}} \parround{1 - \sqrt{\gamma}, \ell}
                            \parround{M}^{-\ell}
                        \eqqcolon \eta
                \]
                and $H$ is at least $\eta$-abundant in $G$.
            \end{proof}
        \end{theorem}

        Notice that this same result can be proved in the general context instead of only for stable graphs
        as the original Theorem 5.1 from~\cite{efficient_testing_of_large_graphs} proves.
        The difference is that the resulting $\eta$ is much larger (although not given explicitly).
        The main reasons of such an improvement, as mentioned earlier, is that neither a double partition is required to
        elude irregular pairs, neither the bound on the number of parts is a tower of powers.
        This allows the resulting set of parts $A_{i_1}, \dots, A_{i_\ell}$, the ones used as a restricted copy of $H$ in $G$
        in the previous theorem, to be a larger proportion of the whole graph, and thus inducing more copies of $H$.

        \begin{remark}
            We now provide a more explicit lower bound for $\eta$ only depending on $\gamma$, $k_*$ and $\ell$ is:
            \[
                \eta \geq \Parround{\frac{1}{2}}^{\frac{\ell^3 + 5\ell -6}{6}}
                    \cdot \delta^{\frac{\ell(\ell-1)}{2}}
                    \cdot \Parround{\frac{1}{24} \min\Parcurly{\sqrt{\gamma},
                        \Parround{\frac{1}{2}}^{\frac{\ell(\ell-1)}{2}} \delta^{\ell-1}}}^{\ell \Parround{2^{k_*+1}-1}}
            \]
        \end{remark}

    \subsection{The Algorithm} \label{subsec:subsection_6.2}

        Now we have all the tools needed to build an $\epsilon$-test $\mathcal{A}$, which decides
        $H$-freeness for a given graph $H$ of size $\ell$, in the context of graphs with the non-$k_*$-order property.

        $\mathcal{A} = \mathcal{A}(H,\epsilon,k_*)$ works as follows.
        Given a graph $H$, with all edges known, a natural number $k_*$, a real number $\epsilon$, and a graph $G$ with
        the non-$k_*$-order property, whose edges are unknown, the algorithm computes $\ell = |H|$, and the value
        $t = \frac{\ell \log\parround{\frac{2}{3}}}
            {\log\parround{1 - \eta_{\ref{thm:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)}}$.
        It then samples $t$ different vertices from $G$ uniformly at random.
        $\mathcal{A}$ queries all edges from the sampled set, and checks whether a copy of $H$ as an induced
        subgraph can be found in it.
        If a copy of $H$ is found, then $\mathcal{A}$ accepts $G$.
        Otherwise, $\mathcal{A}$ rejects it.
        See \Cref{alg:h-freeness_tester} for a more detailed step to step description of $\mathcal{A}$.

        \begin{algorithm}[H]
            \caption{$\epsilon$-test $\mathcal{A}$ for deciding $H$-freeness for a given graph $H$ of size $\ell$}
            \label{alg:h-freeness_tester}
            \begin{algorithmic}[1]
                \Require a graph $H$ of size $\ell$, a natural number $k_*$ and a real number $\epsilon > 0$.
                \Require an oracle $\mathcal{O}$ accepting queries of whether two vertices of a graph $G$ are adjacent.
                    The graph $G$ has the non-$k_*$-order property, and only its size $n$ is known.
                \State $t \leftarrow \ell \log\parround{\frac{2}{3}} /
                    \log\parround{1 - \eta_{\ref{thm:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)}$ \Comment{
                        Compute sample size $t$}
                \If{$n < \ell$} \Comment{Check if $G$ is large enough to contain $H$}
                    \State $\mathcal{A}$ \emph{rejects} $G$ \label{line:G_smaller_then_H}
                \ElsIf{$n < t$} \Comment{Check if $G$ is small enough to query all edges}
                    \State query all pairs of vertices of $G$ to $\mathcal{O}$
                    \If{$\exists v_{i_1}, \dots, v_{i_\ell} \in G$ such that
                            $\parcurly{v_{i_1}, \dots, v_{i_\ell}}$ induces a copy of $H$ in $G$}
                        \State $\mathcal{A}$ \emph{accepts} $G$ \label{line:G_small_enough_found_H}
                    \Else
                        \State $\mathcal{A}$ \emph{rejects} $G$ \label{line:G_small_enough_not_found_H}
                    \EndIf
                \Else \label{line:random_sampling} \Comment{Sample $t$ vertices uniformly at random, without repetitions}
                    \State $S \leftarrow \emptyset$
                    \While{$i \leq t$}
                        \State $s_{i} \sim G$
                        \While{$s_i \in S$} \Comment{Repeat until a new vertex is sampled}
                            \State $s_{i} \sim G$
                        \EndWhile
                        \State $S \leftarrow S \cup \parcurly{s_i}$
                    \EndWhile
                    \State query all pairs of vertices of $S$ to $\mathcal{O}$
                    \If{$\exists v_1, \dots, v_\ell \in S$ such that
                            $\parcurly{v_1, \dots, v_\ell}$ induces a copy of $H$ in $G$}
                        \State $\mathcal{A}$ \emph{accepts} $G$ \label{line:found_H}
                    \Else
                        \State $\mathcal{A}$ \emph{rejects} $G$ \label{line:not_found_H}
                    \EndIf
                \EndIf
            \end{algorithmic}
        \end{algorithm}

        We now proceed to prove that, indeed, $\mathcal{A}$ is an $\epsilon$-test.
        If the input graph $G$ is $H$-free, then the algorithm returns $0$, either because the graph $G$ is too small to
        contain $H$ (\cref{line:G_smaller_then_H}) or because all attempts of finding $H$ as an induced subgraph of $G$
        failed (either \cref{line:G_small_enough_not_found_H} or \cref{line:not_found_H}).
        On the other hand, if $G$ is $\epsilon$-far from being $H$-free, \Cref{thm:property_testing_with_stable_partitions}
        ensures that $H$ is $\eta_{\ref{thm:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)$-abundant in $G$.
        Thus, checking $t_*$ times whether a random sample of $\ell$ vertices contains an
        induced copy of $H$, the probability of not finding any copy of $H$ is at most
        $\parround{1 - \eta_{\ref{thm:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)}^{t_*}$.
        By letting $t_* = \frac{\log\parround{\frac{2}{3}}}
            {\log\parround{1 - \eta_{\ref{thm:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)}}$
        the probability of finding at least one copy of $H$ is at least $\frac{2}{3}$.
        The total number of vertices included in the samples is at most (as there may be repetitions) $t_* \coloneqq t \cdot \ell$,
        and this probability is at most as high as simply querying all the edges within a sample of vertices of size
        $t_*$, and checking whether $H$ appears as an induced subgraph of $G$.
        For completeness, we also need to ensure that $n \geq t_*$.
        If $n < t_*$, then the algorithm simply queries all edges of $G$, checks whether $H$ appears as an induced subgraph
        of $G$ and reports accordingly (either \cref{line:G_small_enough_found_H} or \cref{line:G_small_enough_not_found_H}).

        The resulting query complexity of the algorithm $\mathcal{A}$ can bounded by
        \[
            q \leq {t_* \choose 2}
              \leq \Parround{ \frac{\log\parround{\frac{2}{3}}}
                   {\log\parround{1 - \eta_{\ref{thm:property_testing_with_stable_partitions}}(k_*, \epsilon, \ell)}}}^2
        \]

        \todo{Comment on optimization such as checking if copies of $H$ are found as soon as the sample is large enough and
            stopping early if so.}

        % up to here it was compiling with no problem.